!function(a,e,t,n){CP.MainCanvas=function(){this.getActiveObject=function(){return this.is_layerCircle?this.canvas_layerCircle.getActiveObject():this.is_state?this.canvas.getActiveObject():this.canvas_back.getActiveObject()},this.resetOverlayImageCanvas=function(){null!=this.canvas.overlayImage&&(this.canvas.overlayImage.opacity=1),null!=this.canvas_back.overlayImage&&(this.canvas_back.overlayImage.opacity=1),null!=this.canvas_layerCircle.overlayImage&&(this.canvas_layerCircle.overlayImage.opacity=1)}},CP.MainCanvas.prototype.$el=null,CP.MainCanvas.prototype.$elDriectionProduct=null,CP.MainCanvas.prototype.$elDriectionProductLayerCircle=null,CP.MainCanvas.prototype.$elCanvasFront=null,CP.MainCanvas.prototype.$elCanvasBack=null,CP.MainCanvas.prototype.$elCanvasLayerCircle=null,CP.MainCanvas.prototype.html="",CP.MainCanvas.prototype.canvas=null,CP.MainCanvas.prototype.canvas_back=null,CP.MainCanvas.prototype.canvas_layerCircle=null,CP.MainCanvas.prototype.widthCanvas=670,CP.MainCanvas.prototype.heightCanvas=580,CP.MainCanvas.prototype.casePhone=null,CP.MainCanvas.prototype.casePhone_mask=null,CP.MainCanvas.prototype.id_product=0,CP.MainCanvas.prototype.hoverDragClass="hover-drag",CP.MainCanvas.prototype.hoverDragIconClass="hover-drag-icon",CP.MainCanvas.prototype.getIdProduct=function(){return this.id_product},CP.MainCanvas.prototype.casePhone_back=null,CP.MainCanvas.prototype.casePhone_back_mask=null,CP.MainCanvas.prototype.casePhone_layerCircle=null,CP.MainCanvas.prototype.casePhone_layerCircle_mask=null,CP.MainCanvas.prototype.maskBackgroundCanvas=null,CP.MainCanvas.prototype.centerX=0,CP.MainCanvas.prototype.centerY=0,CP.MainCanvas.prototype.textDict=[],CP.MainCanvas.prototype.assetImgDict=[],CP.MainCanvas.prototype.is_state=!0,CP.MainCanvas.prototype.is_layerCircle=!1,CP.MainCanvas.prototype.hasBack=!1,CP.MainCanvas.prototype.hasLayerCircle=!1,CP.MainCanvas.prototype.lineWidth=12,CP.MainCanvas.prototype.lineColor="#000",jQuery.event.props.push("dataTransfer"),CP.MainCanvas.prototype.init=function(){this.html='<div class="main-canvas-container" ><div class="direction_product" style="  position: absolute;top: -54px;left: 4%;cursor: pointer;"><span class="size-32"><i class="icon ion-ios-loop"></i><span class="name_status"></span></span></div><div class="direction_product_layer_circle" style="  position: absolute;top: -54px;left: 35%;cursor: pointer;"><span class="size-32"><i class="icon ion-ios-albums-outline"></i><span class="">Mặt phẳng</span></span></div><div class="canvas_front"><canvas id="{0}" width="{1}" height="{2}" style="z-index:8"></canvas></div><div class="canvas_back" style="  position: absolute;top: 0;left:10px;visibility:hidden"><canvas id="matsau" width="600" height="500"></canvas></div><div class="canvas_layerCircle" style="  position: absolute;top: 0;left:10px;visibility:hidden"><canvas id="layerCircle" width="600" height="500"></canvas></div></div>',this.html=this.html.format(MYLIB.constant.main_canvas_id,this.widthCanvas,this.heightCanvas),this.$el=a(this.html),this.$elDriectionProduct=this.$el.find(".direction_product"),this.$elDriectionProductLayerCircle=this.$el.find(".direction_product_layer_circle"),this.$elCanvasFront=this.$el.find(".canvas_front"),this.$elCanvasBack=this.$el.find(".canvas_back"),this.$elCanvasLayerCircle=this.$el.find(".canvas_layerCircle"),this.bindEvents()},CP.MainCanvas.prototype.getElement=function(){return this.$el},CP.MainCanvas.prototype.getCanvas=function(){return this.casePhone},CP.MainCanvas.prototype.renderLayout=function(){this.canvas=new fabric.Canvas(MYLIB.constant.main_canvas_id,{renderOnAddition:!1,hoverCursor:"pointer",selection:!0,isDrawingMode:!1}),this.canvas_back=new fabric.Canvas(matsau,{renderOnAddition:!1,hoverCursor:"pointer",selection:!0,isDrawingMode:!1}),this.canvas_layerCircle=new fabric.Canvas(layerCircle,{renderOnAddition:!1,hoverCursor:"pointer",selection:!0,isDrawingMode:!1});var e=this;this.canvas.on({"touch:gesture":function(){},"touch:drag":function(){},"touch:orientation":function(){},"touch:shake":function(){},"touch:longpress":function(){},"object:selected":function(t){e.canvas.overlayImage.opacity=.8,a("#color-horizontal-module").show()},"selection:cleared":function(t){a("#color-horizontal-module").hide(),null!=e.canvas.overlayImage&&(e.canvas.overlayImage.opacity=1)}}),this.canvas_back.on({"touch:gesture":function(){},"touch:drag":function(){},"touch:orientation":function(){},"touch:shake":function(){},"touch:longpress":function(){},"object:selected":function(t){a("#color-horizontal-module").show(),e.canvas_back.overlayImage.opacity=.8},"selection:cleared":function(t){a("#color-horizontal-module").hide(),null!=e.canvas_back.overlayImage&&(e.canvas_back.overlayImage.opacity=1)}}),this.canvas_layerCircle.on({"touch:gesture":function(){},"touch:drag":function(){},"touch:orientation":function(){},"touch:shake":function(){},"touch:longpress":function(){},"object:selected":function(t){a("#color-horizontal-module").show(),e.canvas_layerCircle.overlayImage.opacity=.8},"selection:cleared":function(t){a("#color-horizontal-module").hide(),null!=e.canvas_layerCircle.overlayImage&&(e.canvas_layerCircle.overlayImage.opacity=1)}})},CP.MainCanvas.prototype.showBackProductHandle=function(a){this.is_layerCircle=!1,this.is_state?(this.$elCanvasFront.css("visibility","hidden"),this.$elCanvasBack.css("visibility","visible"),this.$elCanvasLayerCircle.css("visibility","hidden"),this.is_state=!1,this.$el.find(".name_status").text("Mặt sau")):(this.$elCanvasFront.css("visibility","visible"),this.$elCanvasBack.css("visibility","hidden"),this.$elCanvasLayerCircle.css("visibility","hidden"),this.is_state=!0,this.$el.find(".name_status").text("Mặt trước"))},CP.MainCanvas.prototype.showLayerCircleProductHandle=function(a){this.$elCanvasLayerCircle.css("visibility","visible"),this.$elCanvasFront.css("visibility","hidden"),this.$elCanvasBack.css("visibility","hidden"),this.is_layerCircle=!0},CP.MainCanvas.prototype.bindEvents=function(){if(MYLIB.eventManager.subscribe(this,MYLIB.eventNames.chooseProductItem,"chooseProductHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.saveCanvas,"saveCanvasHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_submit_text,"addTextHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_fontSize,"fontSizeHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_change_color,"changeColorHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_delete_item,"deleteHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_duplicate_item,"duplicateHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_change_font,"changeFontHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_opacity,"changeOpacityHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_switch_drawmode,"switchDrawModeHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_free_draw,"freeDrawHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_set_line_width_free_draw,"setLineWidthFreeDrawHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_set_line_color_free_draw,"setLineColorFreeDrawHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_change_partern,"changePartternHandle"),MYLIB.eventManager.subscribe(this,"CURVER_TEXT","curveTextHandle"),MYLIB.eventManager.subscribe(this,"CHANGEFONTWEIGHT","changeFontWeightHandle"),MYLIB.eventManager.subscribe(this,"UPTOFRONT","showUpHandle"),MYLIB.eventManager.subscribe(this,"DOWNTOBACK","BackToUpHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_upload_from_computer,"addImageUploadHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_upload_from_asset,"addImageUploadFormAssetHandle"),a(e).unbind("keydown").bind("keydown",this,this.onKeyDownHandler),!MYLIB.detectBrower()){var t=this;this.$el.addClass(this.hoverDragIconClass),this.$el.bind("dragenter",function(a){return a.preventDefault&&a.preventDefault(),!1}),this.$el.bind("dragleave",function(a){return t.$el.removeClass(t.hoverDragClass),a.preventDefault&&a.preventDefault(),!1}),this.$el.bind("dragover",function(a){return t.$el.addClass(t.hoverDragClass),a.preventDefault&&a.preventDefault(),!1}),this.$el.bind("drop",function(a){t.dragDropImageToCanvas.call(t,a)})}var t=this;a(e).bind("beforeunload",function(){return t.chekHasChange()?"Bạn đang thiết kế dang dỡ, bạn có chắc muốn thoát không?":void 0})},CP.MainCanvas.prototype.chekHasChange=function(){return null!=this.canvas&&this.canvas.item(1)!=n?!0:null!=this.canvas_back&&this.canvas_back.item(1)!=n?!0:null!=this.canvas_layerCircle&&this.canvas_layerCircle.item(1)!=n?!0:!1},CP.MainCanvas.prototype.dragDropImageToCanvas=function(a){a.preventDefault&&a.preventDefault(),this.$el.removeClass(this.hoverDragClass);var e=this;return jQuery.each(a.dataTransfer.files,function(a,t){var n=t.type;if(!MYLIB.checkValidMineType(n))return alert("File phải là hình, chỉ chấp nhận các file kiểu PNG, JPG, JPEG"),!1;var s=new FileReader;s.onload=function(a){return function(a){MYLIB.eventManager.fireEvent(e,MYLIB.eventNames.event_upload_from_computer,a.target.result)}}(t),s.readAsDataURL(t)}),!1},CP.MainCanvas.prototype.deleteHandle=function(a){var e=this.getActiveObject();e&&(this.is_layerCircle?(this.canvas_layerCircle.remove(e),this.canvas_layerCircle.renderAll()):this.is_state?(this.canvas.remove(e),this.canvas.renderAll()):(this.canvas_back.remove(e),this.canvas_back.renderAll()))},CP.MainCanvas.prototype.duplicateHandle=function(a){var e=this.getActiveObject();if(e){var t=fabric.util.object.clone(e);this.is_layerCircle?(this.canvas_layerCircle.add(t),this.canvas_layerCircle.renderAll()):this.is_state?(this.canvas.add(t),this.canvas.renderAll()):(this.canvas_back.add(t),this.canvas_back.renderAll())}},CP.MainCanvas.prototype.onKeyDownHandler=function(a){var e=a.data;switch(a.keyCode){case 46:var t=e.getActiveObject();if(t){var n=t.type||"khongro";switch(n){case"MyText":for(var s=0;s<e.textDict.length;s++){var i=e.textDict[s].getID(),r=t.getID();i===r&&e.textDict.splice(s,1)}e.is_layerCircle?(e.canvas_layerCircle.remove(t),e.canvas_layerCircle.renderAll()):e.is_state?(e.canvas.remove(t),e.canvas.renderAll()):(e.canvas_back.remove(t),e.canvas_back.renderAll());break;default:e.is_layerCircle?(e.canvas_layerCircle.remove(t),e.canvas_layerCircle.renderAll()):e.is_state?(e.canvas.remove(t),e.canvas.renderAll()):(e.canvas_back.remove(t),e.canvas_back.renderAll())}}return}},CP.MainCanvas.prototype.fontSizeHandle=function(a){var e=a.data,t=this.getActiveObject();if(t){var n=t.type||"khongro";switch(n){case"text":t.fontSize=e,this.is_layerCircle?this.canvas_layerCircle.renderAll():this.is_state?this.canvas.renderAll():this.canvas_back.renderAll()}}},CP.MainCanvas.prototype.changeColorHandle=function(a){var e=a.data,t=this.getActiveObject();t&&("text"===t.type||"i-text"===t.type?(t.set({fill:"#"+e}),this.is_layerCircle?this.canvas_layerCircle.renderAll():this.is_state?this.canvas.renderAll():this.canvas_back.renderAll()):"image"===t.type?(t.filters.push(new fabric.Image.filters.Tint({color:"#"+e})),t.applyFilters(this.is_layerCircle?this.canvas_layerCircle.renderAll.bind(this.canvas_layerCircle):this.is_state?this.canvas.renderAll.bind(this.canvas):this.canvas_back.renderAll.bind(this.canvas_back))):(t.set({fill:"#"+e}),this.is_layerCircle?this.canvas_layerCircle.renderAll():this.is_state?this.canvas.renderAll():this.canvas_back.renderAll()))},CP.MainCanvas.prototype.chooseProductHandle=function(a){MYLIB.eventManager.fireEvent(this,MYLIB.eventNames.event_load_product_success,a.data.price);var e=a.data,t=this;this.id_product=e.product_id,this.hasBack=e.isBack,this.hasBack?(this.$elDriectionProduct.show(),this.$elDriectionProduct.unbind("click").bind("click",this.showBackProductHandle.bind(this)),this.$el.find(".name_status").text("Mặt trước")):(this.$elDriectionProduct.hide(),this.$elDriectionProduct.unbind("click")),this.hasLayerCircle=e.isCircleLayer,this.hasLayerCircle?(this.$elDriectionProductLayerCircle.show(),this.$elDriectionProductLayerCircle.unbind("click").bind("click",this.showLayerCircleProductHandle.bind(this))):(this.$elDriectionProductLayerCircle.hide(),this.$elDriectionProductLayerCircle.unbind("click")),MYLIB.LOADING(),this.casePhone_mask=e.product_img_primary_mask,this.canvas.clear(),this.hasBack&&this.canvas_back.clear(),fabric.Image.fromURL(e.product_img_primary,function(a){t.canvas.setWidth(t.widthCanvas),t.canvas.setHeight(t.heightCanvas);var n=t.canvas.width/a.width;1>n?a.scale(n):n=1,t.casePhone=a,t.canvas.add(t.casePhone),t.casePhone.selectable=!1,t.centerX=t.casePhone.currentWidth/2,t.centerY=t.casePhone.currentHeight/2,t.canvas.setOverlayImage(e.product_img_primary_mask,t.canvas.renderAll.bind(t.canvas),{scaleX:n,scaleY:n}),t.canvas.setWidth(t.casePhone.currentWidth),t.canvas.setHeight(t.casePhone.currentHeight),t.canvas.renderAll(),MYLIB.REMOVE_LOADING(),t.loadTemplateToCanvas()}),this.hasBack&&(MYLIB.LOADING(),this.casePhone_back_mask=e.product_img_back_mask,this.canvas_back.clear(),fabric.Image.fromURL(e.product_img_back,function(a){t.canvas_back.setWidth(t.widthCanvas),t.canvas_back.setHeight(t.heightCanvas);var n=t.canvas_back.width/a.width;1>n?a.scale(n):n=1,t.casePhone_back=a,t.canvas_back.add(t.casePhone_back),t.casePhone_back.selectable=!1,t.centerX=t.casePhone_back.currentWidth/2,t.centerY=t.casePhone_back.currentHeight/2,t.canvas_back.setOverlayImage(e.product_img_back_mask,t.canvas_back.renderAll.bind(t.canvas_back),{scaleX:n,scaleY:n}),t.canvas_back.setWidth(t.casePhone_back.currentWidth),t.canvas_back.setHeight(t.casePhone_back.currentHeight),t.canvas_back.renderAll(),MYLIB.REMOVE_LOADING()})),this.hasLayerCircle&&(MYLIB.LOADING(),this.casePhone_layerCircle_mask=e.product_layer_circle_mask,this.canvas_layerCircle.clear(),fabric.Image.fromURL(e.product_layer_circle,function(a){t.canvas_layerCircle.setWidth(t.widthCanvas),t.canvas_layerCircle.setHeight(t.heightCanvas);var n=t.canvas_layerCircle.width/a.width;1>n?a.scale(n):n=1,t.casePhone_layerCircle=a,t.canvas_layerCircle.add(t.casePhone_layerCircle),t.casePhone_layerCircle.selectable=!1,t.centerX=t.casePhone_layerCircle.currentWidth/2,t.centerY=t.casePhone_layerCircle.currentHeight/2,t.canvas_layerCircle.setOverlayImage(e.product_layer_circle_mask,t.canvas_layerCircle.renderAll.bind(t.canvas_layerCircle),{scaleX:n,scaleY:n}),t.canvas_layerCircle.setWidth(t.casePhone_layerCircle.currentWidth),t.canvas_layerCircle.setHeight(t.casePhone_layerCircle.currentHeight),t.canvas_layerCircle.renderAll.call(t.canvas_layerCircle),MYLIB.REMOVE_LOADING()}))},CP.MainCanvas.prototype.addTextHandle=function(a){var e=a.data,t=new fabric.IText(e);t.fontSize=CP_INIT.text.fontSize,t.fontFamily=CP_INIT.text.fontFamilyDefault,this.textDict.push(t),this.is_layerCircle?(this.canvas_layerCircle.add(t),this.canvas_layerCircle.centerObject(t),this.canvas_layerCircle.setActiveObject(t),t.setCoords(),this.canvas_layerCircle.renderAll()):this.is_state?(this.canvas.add(t),this.canvas.centerObject(t),this.canvas.setActiveObject(t),t.setCoords(),this.canvas.renderAll()):(this.canvas_back.add(t),this.canvas_back.centerObject(t),this.canvas_back.setActiveObject(t),t.setCoords(),this.canvas_back.renderAll())},CP.MainCanvas.prototype.addImageUploadHandle=function(a){var e=this,t=a.data,n=a.data;MYLIB.eventManager.fireEvent(e,MYLIB.eventNames.event_display_img,n);var s=new Image;s.src=t,MYLIB.LOADING(),s.onload=function(){MYLIB.REMOVE_LOADING();var a=new fabric.Image(s,{centeredScaling:!0,centeredRotation:!0}),t=e.casePhone.currentWidth/s.width;1>t&&a.scale(t>=.5?t-.4:t);e.canvas.getObjects().length;e.is_layerCircle?e.addObjectToCanvas(e.canvas_layerCircle,a):e.is_state?e.addObjectToCanvas(e.canvas,a):e.addObjectToCanvas(e.canvas_back,a)}},CP.MainCanvas.prototype.addImageUploadFormAssetHandle=function(a){var e=this,t=a.data.src,n=a.data.src,s=a.data.id,i=a.data.thumb;MYLIB.eventManager.fireEvent(e,MYLIB.eventNames.event_display_img,n);var r=new Image;r.src=t,MYLIB.LOADING(),r.onload=function(){MYLIB.REMOVE_LOADING();var a=new fabric.Image(r,{centeredScaling:!0,centeredRotation:!0}),n=e.casePhone.currentWidth/r.width;1>n&&a.scale(n>=.5?n-.4:n);e.canvas.getObjects().length;e.is_layerCircle?e.addObjectToCanvas(e.canvas_layerCircle,a):e.is_state?e.addObjectToCanvas(e.canvas,a):e.addObjectToCanvas(e.canvas_back,a),e.assetImgDict&&e.assetImgDict.push({id:s,src:t,thumb:i})}},CP.MainCanvas.prototype.drawShape=function(a){switch(a){case"CIRCLE":var e=this,t=new fabric.Circle({radius:50,borderColor:"#000"});e.is_layerCircle?e.addObjectToCanvas(e.canvas_layerCircle,t):e.is_state?e.addObjectToCanvas(e.canvas,t):e.addObjectToCanvas(e.canvas_back,t);break;case"RECT":var n=new fabric.Rect({originX:"left",originY:"top",width:150,height:120,fill:"green",transparentCorners:!1});this.is_layerCircle?this.addObjectToCanvas(this.canvas_layerCircle,n):this.is_state?this.addObjectToCanvas(this.canvas,n):this.addObjectToCanvas(this.canvas_back,n)}},CP.MainCanvas.prototype.showUpHandle=function(a){this.getActiveObject()&&this.getActiveObject().bringForward()},CP.MainCanvas.prototype.BackToUpHandle=function(){this.getActiveObject()&&this.getActiveObject().sendBackwards()},CP.MainCanvas.prototype.rotateRepeatHandle=function(){this.getActiveObject()&&this.rotateObject(90)},CP.MainCanvas.prototype.rotateObject=function(a){var e=this.getActiveObject(),t=!1;if(e){var n=e.getAngle()+a;"center"===e.originX&&"center"===e.originY||!e.centeredRotation||(e.setOriginToCenter&&e.setOriginToCenter(),t=!0),n=n>360?90:0>n?270:n,e.setAngle(n).setCoords(),t&&e.setCenterToOrigin&&e.setCenterToOrigin(),this.is_layerCircle?this.canvas_layerCircle.renderAll():this.is_state?this.canvas.renderAll():this.canvas_back.renderAll()}},CP.MainCanvas.prototype.saveCanvasHandle=function(a){},CP.MainCanvas.prototype.saveCanvasToSVG=function(a){return this.canvas.deactivateAll().renderAll(),this.canvas.item(1).toSVG()},CP.MainCanvas.prototype.saveCanvasToImg=function(a){this.canvas.deactivateAll().renderAll();this.canvas.toSVG();return this.canvas.toDataURL()},CP.MainCanvas.prototype.saveCanvasBackToImg=function(a){this.canvas_back.deactivateAll().renderAll();this.canvas_back.toSVG();return this.canvas_back.toDataURL()},CP.MainCanvas.prototype.saveLayerCircleCanvasToImg=function(){this.canvas_layerCircle.deactivateAll().renderAll();this.canvas_layerCircle.toSVG();return this.canvas_layerCircle.toDataURL()},CP.MainCanvas.prototype.getImageFrontToPrint=function(a){this.canvas.deactivateAll().renderAll(),this.canvas.setOverlayImage(null),this.canvas.remove(this.canvas.item(0));var e=this.canvas.toDataURL({format:"png",multiplier:2});return e},CP.MainCanvas.prototype.getImageBackToPrint=function(a){this.canvas_back.deactivateAll().renderAll(),this.canvas_back.setOverlayImage(null),this.canvas_back.remove(this.canvas_back.item(0));var e=this.canvas_back.toDataURL({format:"png",multiplier:2});return e},CP.MainCanvas.prototype.getImgLayerCircleToPrint=function(a){this.canvas_layerCircle.deactivateAll().renderAll(),this.canvas_layerCircle.setOverlayImage(null),this.canvas_layerCircle.remove(this.canvas_layerCircle.item(0));var e=this.canvas_layerCircle.toDataURL({format:"png",multiplier:2});return e},CP.MainCanvas.prototype.zoomHandle=function(a){var e=a,t=this.getActiveObject();if(t)switch(e){case"ZOOMIN":var n=t.getScaleX();t.scale(parseFloat(n+.05)).setCoords(),this.is_layerCircle?this.canvas_layerCircle.renderAll():this.is_state?this.canvas.renderAll():this.canvas_back.renderAll();break;case"ZOOMOUT":var n=t.getScaleX();t.scale(parseFloat(n-.05)).setCoords(),this.is_layerCircle?this.canvas_layerCircle.renderAll():this.is_state?this.canvas.renderAll():this.canvas_back.renderAll()}},CP.MainCanvas.prototype.rotateHandle=function(a){var e=a,t=this.getActiveObject();if(t)switch(e){case"ROTATELEFT":var n=t.getAngle();t.setAngle(parseInt(n-10)).setCoords(),this.is_layerCircle?this.canvas_layerCircle.renderAll():this.is_state?this.canvas.renderAll():this.canvas_back.renderAll();break;case"ROTATERIGHT":var n=t.getAngle();t.setAngle(parseInt(n+10)).setCoords(),this.is_state?this.canvas.renderAll():this.canvas_back.renderAll()}},CP.MainCanvas.prototype.changeFontHandle=function(a){var e=this.getActiveObject(),t=a.data;e.fontFamily=t,this.is_layerCircle?this.canvas_layerCircle.renderAll():this.is_state?this.canvas.renderAll():this.canvas_back.renderAll()},CP.MainCanvas.prototype.changeFontWeightHandle=function(a){var e=this.getActiveObject(),t=a.data;e.fontWeight=t,this.is_layerCircle?this.canvas_layerCircle.renderAll():this.is_state?this.canvas.renderAll():this.canvas_back.renderAll()},CP.MainCanvas.prototype.changeOpacityHandle=function(a){var e=a.data,t=this.getActiveObject();t&&(t.opacity=e/100,this.is_layerCircle?this.canvas_layerCircle.renderAll():this.is_state?this.canvas.renderAll():this.canvas_back.renderAll())},CP.MainCanvas.prototype.switchDrawModeHandle=function(a){var e=a.data;this.canvas.isDrawingMode=e,this.hasBack&&(this.canvas_back.isDrawingMode=e),this.hasLayerCircle&&(this.canvas_layerCircle.isDrawingMode=e)},CP.MainCanvas.prototype.freeDrawHandle=function(a){var e=a.data;this.is_layerCircle?(this.canvas_layerCircle.freeDrawingBrush=new fabric[e+"Brush"](this.canvas_layerCircle),this.canvas_layerCircle.freeDrawingBrush.width=parseInt(this.lineWidth,10)||1,this.canvas_layerCircle.freeDrawingBrush.color=this.lineColor):this.is_state?(this.canvas.freeDrawingBrush=new fabric[e+"Brush"](this.canvas),this.canvas.freeDrawingBrush.width=parseInt(this.lineWidth,10)||1,this.canvas.freeDrawingBrush.color=this.lineColor):(this.canvas_back.freeDrawingBrush=new fabric[e+"Brush"](this.canvas_back),this.canvas_back.freeDrawingBrush.width=parseInt(this.lineWidth,10)||1,this.canvas_back.freeDrawingBrush.color=this.lineColor)},CP.MainCanvas.prototype.setLineWidthFreeDrawHandle=function(a){var e=a.data;this.lineWidth=e,this.is_layerCircle?this.canvas_layerCircle.freeDrawingBrush.width=parseInt(this.lineWidth,10)||1:this.is_state?this.canvas.freeDrawingBrush.width=parseInt(this.lineWidth,10)||1:this.canvas_back.freeDrawingBrush.width=parseInt(this.lineWidth,10)||1},CP.MainCanvas.prototype.setLineColorFreeDrawHandle=function(a){var e=a.data;this.lineColor=e,this.is_layerCircle?this.canvas_layerCircle.freeDrawingBrush.color=this.lineColor:this.is_state?this.canvas.freeDrawingBrush.color=this.lineColor:this.canvas_back.freeDrawingBrush.color=this.lineColor},CP.MainCanvas.prototype.changePartternHandle=function(a){var e=a.data,t=this.getActiveObject(),n=new Image;n.src=e,MYLIB.LOADING();var s=this;n.onload=function(){n.width=t.width;var a=new fabric.Pattern({source:n,repeat:"repeat"});t.fontSize=250,t.fill=a,s.is_layerCircle?(s.canvas_layerCircle.setActiveObject(t),t.scale(.2),s.canvas_layerCircle.renderAll()):s.is_state?(s.canvas.setActiveObject(t),t.scale(.2),s.canvas.renderAll()):(s.canvas_back.setActiveObject(t),t.scale(.2),s.canvas_back.renderAll()),MYLIB.REMOVE_LOADING()}},CP.MainCanvas.prototype.curveTextHandle=function(){this.getActiveObject()},CP.MainCanvas.prototype.getItemFromCanvas=function(){var a=[],e=[],t=[];a=this.canvas.toJSON(),this.hasBack&&(e=this.canvas_back.toJSON()),this.hasLayerCircle&&(t=this.canvas_layerCircle.toJSON());var n={front:a,back:e,layerCircle:t};return n},CP.MainCanvas.prototype.loadTemplateToCanvas=function(e){var t=this,n=MYLIB.getParamURL("ref"),s=new CP.OrdersSerice;s.param.data={id:n};var i=s.getTemplateOrder(),t=this;MYLIB.LOADING(),i.done(function(e){a.getJSON(MYLIB.IMAGEHOST+e.json,function(a,e){MYLIB.LOADING(),0!=_.size(a.front)&&(a.front.objects.unshift(t.casePhone.toObject()),t.canvas.loadFromJSON(a.front,function(){t.canvas.renderAll.call(t.canvas),t.canvas.item(0).selectable=!1,t.applyImageFilters(t.canvas)},function(a,e){})),t.hasBack&&0!=_.size(a.back)&&(a.back.objects.unshift(t.casePhone_back.toObject()),t.canvas_back.loadFromJSON(a.back,function(){t.canvas_back.renderAll.call(t.canvas_back),t.canvas_back.item(0).selectable=!1,t.applyImageFilters(t.canvas_back)},function(a,e){})),t.hasLayerCircle&&0!=_.size(a.layerCircle)&&_.size(a.layerCircle.objects)>2&&(a.layerCircle.objects.unshift(t.casePhone_layerCircle.toObject()),t.canvas_layerCircle.loadFromJSON(a.layerCircle,function(){t.canvas_layerCircle.renderAll.call(t.canvas_layerCircle),t.canvas_layerCircle.item(0).selectable=!1,_.size(a.layerCircle.objects)>2&&t.$elDriectionProductLayerCircle.trigger("click"),t.applyImageFilters(t.canvas_layerCircle)},function(a,e){})),MYLIB.REMOVE_LOADING()})})},CP.MainCanvas.prototype.applyImageFilters=function(a){a.forEachObject(function(a){"image"===a.type&&a.filters.length&&a.applyFilters(function(){a.canvas.renderAll()})})},CP.MainCanvas.prototype.addObjectToCanvas=function(a,e){a.add(e),e.set({borderColor:"gray",cornerColor:"black",cornerSize:16,transparentCorners:!0}),a.centerObject(e),a.setActiveObject(e),e.setCoords(),a.renderAll()},MYLIB.mixin(CP.MainCanvas,MYLIB.Event.ObserverMixin)}(jQuery,window,document);