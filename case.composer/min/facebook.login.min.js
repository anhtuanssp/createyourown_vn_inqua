!function(e,a,o,t){CP.FacebookLoginModule=function(e){this.$el=null,this.parent=e,this.htmlNotAuth='<div id="facebook-login-zone"><span class="btn btn-primary" style="margin: 0px;"onclick="CP.FacebookService.getInstance.loginFacebook()"><i class="fa fa-facebook size-18" style="color:#fff"></i> Đăng nhập với Facebook <i class="fa fa-share"></i></span><hr/></div>',this.htmlAuth='<div id="facebook-login-zone" style="text-align:center;padding:10px;background:#45619D;color:#fafafa;margin-bottom:10px;-webkit-box-shadow: -10px 9px 0px -2px rgba(255,213,0,1);-moz-box-shadow: -10px 9px 0px -2px rgba(255,213,0,1);box-shadow: -10px 9px 0px -2px rgba(255,213,0,1);"><div style="width:70px;overflow:hidden; display: inline-block;"><i class="fa fa-facebook size-32" style="color:#fff;position: absolute;"></i><a href="profile.html" style="color:#fff"><img class="img-profile" src="" style="width:100%"/></a></div><br/>Chào :<b><a href="profile.html" style="color:#fff"><span class="username"> </span></a></b><br/><span class="btn btn-primary bnt-logout"> Log out </span><span class="btn btn-primary bnt-share"> Share <i class="fa fa-share"></i> </span></div>',this.popupShare=new CP.FacebookLoginModule.PopupShareFacebook(this.parent),this.popupShare.init()},CP.FacebookLoginModule.prototype.init=function(e){if("undefined"!=typeof FB)this.renderLayout(e);else var o=this,t=setInterval(function(){"undefined"!=typeof FB&&(FB.Event.subscribe("auth.statusChange",o.auth_status_change_callback.bind(o)),o.renderLayout(e),a.clearInterval(t))},1e3)},CP.FacebookLoginModule.prototype.renderLayout=function(e){CP.FacebookService.getInstance.checkLogin(this.renderLayoutAuth.bind(this,e),this.renderLayoutNotAuth.bind(this,e),this.renderLayoutNotAuth.bind(this,e))},CP.FacebookLoginModule.prototype.logout=function(){FB.logout(function(e){})},CP.FacebookLoginModule.prototype.renderLayoutNotAuth=function(a){this.$el=e(this.htmlNotAuth),a()},CP.FacebookLoginModule.prototype.renderLayoutAuth=function(a){this.$el=e(this.htmlAuth);var o=this;CP.FacebookService.getInstance.getInfo(function(e){o.$el.find(".username").html(e.name)}),FB.api("/me/picture?type=large",function(e){o.$el.find(".img-profile").attr("src",e.data.url)}),this.$el.find(".bnt-logout").click(function(e){o.logout()}),this.$el.find(".bnt-share").click(function(e){o.openPopupShare()}),a()},CP.FacebookLoginModule.prototype.openPopupShare=function(){this.popupShare.show()},CP.FacebookLoginModule.prototype.auth_status_change_callback=function(e){var a=this;null!=e.authResponse?(CP.FacebookService.getInstance.getInfo(function(a){CP.FacebookService.getInstance.getProfilePic(function(o){var t=new CP.FacebookServiceTracking;t.param.id=e.authResponse.userID,t.param.json_me=JSON.stringify(a),t.param.json_picture=JSON.stringify(o);var n=t.create();n.done(function(e){})})}),null!=this.$el&&(this.$el.remove(),this.renderLayoutAuth(function(){a.parent.$el.prepend(a.$el)}))):(this.$el.remove(),this.renderLayoutNotAuth(function(){a.parent.$el.prepend(a.$el)}))},CP.FacebookLoginModule.PopupShareFacebook=function(e){this.parentScope=e,this.view='<div style="padding:20px"><form><legend>Điền thông tin để share</legend><div class="form-group"><label for="">Chia sẽ</label><input type="text" class="form-control" id="message" placeholder="Nhập nội dung bạn muốn chia sẽ"></div><div class="review" style=""><canvas id="share_facebook" width="470px" height="246px"></div><br/><div style="position: absolute;top: 26%;right: 4%;"><span class="share-facebook btn btn-default btn-primary">Share now <i class="fa fa-share"></i></span>',this.canvasShare=null,this.fb_textMsg=new fabric.Text("",{left:20,top:170,fontSize:20,fill:"#fff",fontFamily:"SVN-Aaron Script"})},MYLIB.extend(CP.FacebookLoginModule.PopupShareFacebook,CP.PopupModule),CP.FacebookLoginModule.PopupShareFacebook.prototype.init=function(){this.titlePopup="Share lên facebook của bạn",this.parent.proto.init.call(this),this.$el.appendTo("body"),this.$el.find(".modal-lg").removeClass("modal-lg").css({width:"550px"}),this.$elContent.append(this.view),this.canvasShare=new fabric.Canvas("share_facebook",{renderOnAddition:!1,hoverCursor:"pointer",selection:!0,isDrawingMode:!1}),this.canvasShare.setBackgroundColor("#FFEC16"),this.$el.find(".share-facebook").unbind("click").bind("click",this.shareFacebookHandler.bind(this)),this.$el.find("#message").unbind("change").bind("change",this.changeTextShareFacebook.bind(this));var e=this;setInterval(function(){e.changeTextShareFacebook()},2e3)},CP.FacebookLoginModule.PopupShareFacebook.prototype.changeTextShareFacebook=function(){this.fb_textMsg.text=this.$el.find("#message").val(),this.fb_textMsg.setCoords(),this.canvasShare.deactivateAll().renderAll()},CP.FacebookLoginModule.PopupShareFacebook.prototype.shareFacebookHandler=function(){var e=new CP.FacebookServiceTracking,a=this,t=this.$el.find("#message").val(),n=o.URL;CP.FacebookService.getInstance.getInfo(function(o){a.canvasShare.deactivateAll().renderAll();var i=a.canvasShare.toDataURL({format:"png",multiplier:2}),c=e.uploadSharePhoto({share_photo:i,facebook_id:o.id});c.done(function(e){CP.FacebookService.getInstance.checkLogin(function(){CP.FacebookService.getInstance.shareUI(n,MYLIB.IMAGEHOST+e.url,t)},function(){CP.FacebookService.getInstance.loginFacebook(function(){CP.FacebookService.getInstance.shareUI(n,MYLIB.IMAGEHOST+e.url,t)})},function(){fb.loginFacebook(function(){CP.FacebookService.getInstance.shareUI(n,MYLIB.IMAGEHOST+e.url,t)})})})})},CP.FacebookLoginModule.PopupShareFacebook.prototype.show=function(){this.$el.modal("show");var e=this;e.canvasShare.clear().renderAll(),this.canvasShare.add(new fabric.Rect({top:150,left:0,width:470,height:80,fill:"#45619D"}),new fabric.Text("inqua.vn",{left:30,top:10,fontSize:60,fill:"#fff",fontWeight:"bold"}),new fabric.Text("Create Your Own",{left:30,top:88,fontSize:20,fill:"#000"}),new fabric.Text("Thank for your sharing",{left:30,top:200,fontSize:14,fill:"#fff"})),this.canvasShare.add(this.fb_textMsg);var a=new Image;if(a.src="http://inqua.vn/cms/public/packages/anahkiasen/illuminage/f07bc2ba74e90b7c7b6b889b02da05d5.png",a.onload=function(){var o=new fabric.Image(a,{centeredScaling:!0,centeredRotation:!0,scaleX:100/a.width,scaleY:100/a.height,left:350,top:20});e.canvasShare.add(o)},this.parentScope.callBackDashboardModule.rightModule.getMainCanvas().hasBack){var o=new Image;o.src=this.parentScope.callBackDashboardModule.rightModule.getMainCanvas().saveCanvasToImg(),o.onload=function(){var a=new fabric.Image(o,{centeredScaling:!0,centeredRotation:!0,scaleX:100/o.width,scaleY:100/o.height,stroke:"#c9c9c9",strokeWidth:10,left:250,top:140});e.canvasShare.add(a)};var t=new Image;t.src=this.parentScope.callBackDashboardModule.rightModule.getMainCanvas().saveCanvasBackToImg(),t.onload=function(){var a=new fabric.Image(t,{centeredScaling:!0,centeredRotation:!0,scaleX:100/t.width,scaleY:100/t.height,left:360,top:140,stroke:"#c9c9c9",strokeWidth:10});e.canvasShare.add(a)}}else{var o=new Image;o.src=this.parentScope.callBackDashboardModule.rightModule.getMainCanvas().saveCanvasToImg(),o.onload=function(){var a=new fabric.Image(o,{centeredScaling:!0,centeredRotation:!0,scaleX:100/o.width,scaleY:100/o.height,stroke:"#c9c9c9",strokeWidth:10,left:400,top:140});e.canvasShare.add(a)}}}}(jQuery,window,document);