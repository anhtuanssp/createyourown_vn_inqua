!function(t,e,i,n){CP.AssetsSerice=function(){},CP.AssetsSerice.prototype.param=null,CP.AssetsSerice.prototype.getAssetsCates=function(){var e=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.getAssetCates,type:"GET",dataType:"json"});return e},CP.AssetsSerice.prototype.getAssetsMediaByCates=function(e){var i=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.getAssetMediaByCate+"/"+e,type:"GET",dataType:"json"});return i}}(jQuery,window,document),!function(t,e,i,n){CP.MainCanvas=function(){this.getActiveObject=function(){return this.is_layerCircle?this.canvas_layerCircle.getActiveObject():this.is_state?this.canvas.getActiveObject():this.canvas_back.getActiveObject()},this.resetOverlayImageCanvas=function(){null!=this.canvas.overlayImage&&(this.canvas.overlayImage.opacity=1),null!=this.canvas_back.overlayImage&&(this.canvas_back.overlayImage.opacity=1),null!=this.canvas_layerCircle.overlayImage&&(this.canvas_layerCircle.overlayImage.opacity=1)}},CP.MainCanvas.prototype.$el=null,CP.MainCanvas.prototype.$elDriectionProduct=null,CP.MainCanvas.prototype.$elDriectionProductLayerCircle=null,CP.MainCanvas.prototype.$elCanvasFront=null,CP.MainCanvas.prototype.$elCanvasBack=null,CP.MainCanvas.prototype.$elCanvasLayerCircle=null,CP.MainCanvas.prototype.html="",CP.MainCanvas.prototype.canvas=null,CP.MainCanvas.prototype.canvas_back=null,CP.MainCanvas.prototype.canvas_layerCircle=null,CP.MainCanvas.prototype.widthCanvas=670,CP.MainCanvas.prototype.heightCanvas=580,CP.MainCanvas.prototype.casePhone=null,CP.MainCanvas.prototype.casePhone_mask=null,CP.MainCanvas.prototype.id_product=0,CP.MainCanvas.prototype.hoverDragClass="hover-drag",CP.MainCanvas.prototype.hoverDragIconClass="hover-drag-icon",CP.MainCanvas.prototype.getIdProduct=function(){return this.id_product},CP.MainCanvas.prototype.casePhone_back=null,CP.MainCanvas.prototype.casePhone_back_mask=null,CP.MainCanvas.prototype.casePhone_layerCircle=null,CP.MainCanvas.prototype.casePhone_layerCircle_mask=null,CP.MainCanvas.prototype.maskBackgroundCanvas=null,CP.MainCanvas.prototype.centerX=0,CP.MainCanvas.prototype.centerY=0,CP.MainCanvas.prototype.textDict=[],CP.MainCanvas.prototype.assetImgDict=[],CP.MainCanvas.prototype.is_state=!0,CP.MainCanvas.prototype.is_layerCircle=!1,CP.MainCanvas.prototype.hasBack=!1,CP.MainCanvas.prototype.hasLayerCircle=!1,CP.MainCanvas.prototype.lineWidth=12,CP.MainCanvas.prototype.lineColor="#000",jQuery.event.props.push("dataTransfer"),CP.MainCanvas.prototype.init=function(){this.html='<div class="main-canvas-container" ><div class="direction_product" style="  position: absolute;top: -54px;left: 4%;cursor: pointer;"><span class="size-32"><i class="icon ion-ios-loop"></i><span class="name_status"></span></span></div><div class="direction_product_layer_circle" style="  position: absolute;top: -54px;left: 35%;cursor: pointer;"><span class="size-32"><i class="icon ion-ios-albums-outline"></i><span class="">Mặt phẳng</span></span></div><div class="canvas_front"><canvas id="{0}" width="{1}" height="{2}" style="z-index:8"></canvas></div><div class="canvas_back" style="  position: absolute;top: 0;left:10px;visibility:hidden"><canvas id="matsau" width="600" height="500"></canvas></div><div class="canvas_layerCircle" style="  position: absolute;top: 0;left:10px;visibility:hidden"><canvas id="layerCircle" width="600" height="500"></canvas></div></div>',this.html=this.html.format(MYLIB.constant.main_canvas_id,this.widthCanvas,this.heightCanvas),this.$el=t(this.html),this.$elDriectionProduct=this.$el.find(".direction_product"),this.$elDriectionProductLayerCircle=this.$el.find(".direction_product_layer_circle"),this.$elCanvasFront=this.$el.find(".canvas_front"),this.$elCanvasBack=this.$el.find(".canvas_back"),this.$elCanvasLayerCircle=this.$el.find(".canvas_layerCircle"),this.bindEvents()},CP.MainCanvas.prototype.getElement=function(){return this.$el},CP.MainCanvas.prototype.getCanvas=function(){return this.casePhone},CP.MainCanvas.prototype.renderLayout=function(){this.canvas=new fabric.Canvas(MYLIB.constant.main_canvas_id,{renderOnAddition:!1,hoverCursor:"pointer",selection:!0,isDrawingMode:!1}),this.canvas_back=new fabric.Canvas(matsau,{renderOnAddition:!1,hoverCursor:"pointer",selection:!0,isDrawingMode:!1}),this.canvas_layerCircle=new fabric.Canvas(layerCircle,{renderOnAddition:!1,hoverCursor:"pointer",selection:!0,isDrawingMode:!1});var e=this;this.canvas.on({"touch:gesture":function(){},"touch:drag":function(){},"touch:orientation":function(){},"touch:shake":function(){},"touch:longpress":function(){},"object:selected":function(i){e.canvas.overlayImage.opacity=.8,t("#color-horizontal-module").show()},"selection:cleared":function(i){t("#color-horizontal-module").hide(),null!=e.canvas.overlayImage&&(e.canvas.overlayImage.opacity=1)}}),this.canvas_back.on({"touch:gesture":function(){},"touch:drag":function(){},"touch:orientation":function(){},"touch:shake":function(){},"touch:longpress":function(){},"object:selected":function(i){t("#color-horizontal-module").show(),e.canvas_back.overlayImage.opacity=.8},"selection:cleared":function(i){t("#color-horizontal-module").hide(),null!=e.canvas_back.overlayImage&&(e.canvas_back.overlayImage.opacity=1)}}),this.canvas_layerCircle.on({"touch:gesture":function(){},"touch:drag":function(){},"touch:orientation":function(){},"touch:shake":function(){},"touch:longpress":function(){},"object:selected":function(i){t("#color-horizontal-module").show(),e.canvas_layerCircle.overlayImage.opacity=.8},"selection:cleared":function(i){t("#color-horizontal-module").hide(),null!=e.canvas_layerCircle.overlayImage&&(e.canvas_layerCircle.overlayImage.opacity=1)}})},CP.MainCanvas.prototype.showBackProductHandle=function(t){this.is_layerCircle=!1,this.is_state?(this.$elCanvasFront.css("visibility","hidden"),this.$elCanvasBack.css("visibility","visible"),this.$elCanvasLayerCircle.css("visibility","hidden"),this.is_state=!1,this.$el.find(".name_status").text("Mặt sau")):(this.$elCanvasFront.css("visibility","visible"),this.$elCanvasBack.css("visibility","hidden"),this.$elCanvasLayerCircle.css("visibility","hidden"),this.is_state=!0,this.$el.find(".name_status").text("Mặt trước"))},CP.MainCanvas.prototype.showLayerCircleProductHandle=function(t){this.$elCanvasLayerCircle.css("visibility","visible"),this.$elCanvasFront.css("visibility","hidden"),this.$elCanvasBack.css("visibility","hidden"),this.is_layerCircle=!0},CP.MainCanvas.prototype.bindEvents=function(){if(MYLIB.eventManager.subscribe(this,MYLIB.eventNames.chooseProductItem,"chooseProductHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.saveCanvas,"saveCanvasHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_submit_text,"addTextHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_fontSize,"fontSizeHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_change_color,"changeColorHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_delete_item,"deleteHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_duplicate_item,"duplicateHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_change_font,"changeFontHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_opacity,"changeOpacityHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_switch_drawmode,"switchDrawModeHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_free_draw,"freeDrawHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_set_line_width_free_draw,"setLineWidthFreeDrawHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_set_line_color_free_draw,"setLineColorFreeDrawHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_change_partern,"changePartternHandle"),MYLIB.eventManager.subscribe(this,"CURVER_TEXT","curveTextHandle"),MYLIB.eventManager.subscribe(this,"CHANGEFONTWEIGHT","changeFontWeightHandle"),MYLIB.eventManager.subscribe(this,"UPTOFRONT","showUpHandle"),MYLIB.eventManager.subscribe(this,"DOWNTOBACK","BackToUpHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_upload_from_computer,"addImageUploadHandle"),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_upload_from_asset,"addImageUploadFormAssetHandle"),t(e).unbind("keydown").bind("keydown",this,this.onKeyDownHandler),!MYLIB.detectBrower()){var i=this;this.$el.addClass(this.hoverDragIconClass),this.$el.bind("dragenter",function(t){return t.preventDefault&&t.preventDefault(),!1}),this.$el.bind("dragleave",function(t){return i.$el.removeClass(i.hoverDragClass),t.preventDefault&&t.preventDefault(),!1}),this.$el.bind("dragover",function(t){return i.$el.addClass(i.hoverDragClass),t.preventDefault&&t.preventDefault(),!1}),this.$el.bind("drop",function(t){i.dragDropImageToCanvas.call(i,t)})}var i=this;t(e).bind("beforeunload",function(){return i.chekHasChange()?"Bạn đang thiết kế dang dỡ, bạn có chắc muốn thoát không?":void 0})},CP.MainCanvas.prototype.chekHasChange=function(){return null!=this.canvas&&this.canvas.item(1)!=n?!0:null!=this.canvas_back&&this.canvas_back.item(1)!=n?!0:null!=this.canvas_layerCircle&&this.canvas_layerCircle.item(1)!=n?!0:!1},CP.MainCanvas.prototype.dragDropImageToCanvas=function(t){t.preventDefault&&t.preventDefault(),this.$el.removeClass(this.hoverDragClass);var e=this;return jQuery.each(t.dataTransfer.files,function(t,i){var n=i.type;if(!MYLIB.checkValidMineType(n))return alert("File phải là hình, chỉ chấp nhận các file kiểu PNG, JPG, JPEG"),!1;var o=new FileReader;o.onload=function(t){return function(t){MYLIB.eventManager.fireEvent(e,MYLIB.eventNames.event_upload_from_computer,t.target.result)}}(i),o.readAsDataURL(i)}),!1},CP.MainCanvas.prototype.deleteHandle=function(t){var e=this.getActiveObject();e&&(this.is_layerCircle?(this.canvas_layerCircle.remove(e),this.canvas_layerCircle.renderAll()):this.is_state?(this.canvas.remove(e),this.canvas.renderAll()):(this.canvas_back.remove(e),this.canvas_back.renderAll()))},CP.MainCanvas.prototype.duplicateHandle=function(t){var e=this.getActiveObject();if(e){var i=fabric.util.object.clone(e);this.is_layerCircle?(this.canvas_layerCircle.add(i),this.canvas_layerCircle.renderAll()):this.is_state?(this.canvas.add(i),this.canvas.renderAll()):(this.canvas_back.add(i),this.canvas_back.renderAll())}},CP.MainCanvas.prototype.onKeyDownHandler=function(t){var e=t.data;switch(t.keyCode){case 46:var i=e.getActiveObject();if(i){var n=i.type||"khongro";switch(n){case"MyText":for(var o=0;o<e.textDict.length;o++){var a=e.textDict[o].getID(),s=i.getID();a===s&&e.textDict.splice(o,1)}e.is_layerCircle?(e.canvas_layerCircle.remove(i),e.canvas_layerCircle.renderAll()):e.is_state?(e.canvas.remove(i),e.canvas.renderAll()):(e.canvas_back.remove(i),e.canvas_back.renderAll());break;default:e.is_layerCircle?(e.canvas_layerCircle.remove(i),e.canvas_layerCircle.renderAll()):e.is_state?(e.canvas.remove(i),e.canvas.renderAll()):(e.canvas_back.remove(i),e.canvas_back.renderAll())}}return}},CP.MainCanvas.prototype.fontSizeHandle=function(t){var e=t.data,i=this.getActiveObject();if(i){var n=i.type||"khongro";switch(n){case"text":i.fontSize=e,this.is_layerCircle?this.canvas_layerCircle.renderAll():this.is_state?this.canvas.renderAll():this.canvas_back.renderAll()}}},CP.MainCanvas.prototype.changeColorHandle=function(t){var e=t.data,i=this.getActiveObject();i&&("text"===i.type||"i-text"===i.type?(i.set({fill:"#"+e}),this.is_layerCircle?this.canvas_layerCircle.renderAll():this.is_state?this.canvas.renderAll():this.canvas_back.renderAll()):"image"===i.type?(i.filters.push(new fabric.Image.filters.Tint({color:"#"+e})),i.applyFilters(this.is_layerCircle?this.canvas_layerCircle.renderAll.bind(this.canvas_layerCircle):this.is_state?this.canvas.renderAll.bind(this.canvas):this.canvas_back.renderAll.bind(this.canvas_back))):(i.set({fill:"#"+e}),this.is_layerCircle?this.canvas_layerCircle.renderAll():this.is_state?this.canvas.renderAll():this.canvas_back.renderAll()))},CP.MainCanvas.prototype.chooseProductHandle=function(t){MYLIB.eventManager.fireEvent(this,MYLIB.eventNames.event_load_product_success,t.data.price);var e=t.data,i=this;this.id_product=e.product_id,this.hasBack=e.isBack,this.hasBack?(this.$elDriectionProduct.show(),this.$elDriectionProduct.unbind("click").bind("click",this.showBackProductHandle.bind(this)),this.$el.find(".name_status").text("Mặt trước")):(this.$elDriectionProduct.hide(),this.$elDriectionProduct.unbind("click")),this.hasLayerCircle=e.isCircleLayer,this.hasLayerCircle?(this.$elDriectionProductLayerCircle.show(),this.$elDriectionProductLayerCircle.unbind("click").bind("click",this.showLayerCircleProductHandle.bind(this))):(this.$elDriectionProductLayerCircle.hide(),this.$elDriectionProductLayerCircle.unbind("click")),MYLIB.LOADING(),this.casePhone_mask=e.product_img_primary_mask,this.canvas.clear(),this.hasBack&&this.canvas_back.clear(),fabric.Image.fromURL(e.product_img_primary,function(t){i.canvas.setWidth(i.widthCanvas),i.canvas.setHeight(i.heightCanvas);var n=i.canvas.width/t.width;1>n?t.scale(n):n=1,i.casePhone=t,i.canvas.add(i.casePhone),i.casePhone.selectable=!1,i.centerX=i.casePhone.currentWidth/2,i.centerY=i.casePhone.currentHeight/2,i.canvas.setOverlayImage(e.product_img_primary_mask,i.canvas.renderAll.bind(i.canvas),{scaleX:n,scaleY:n}),i.canvas.setWidth(i.casePhone.currentWidth),i.canvas.setHeight(i.casePhone.currentHeight),i.canvas.renderAll(),MYLIB.REMOVE_LOADING(),i.loadTemplateToCanvas()}),this.hasBack&&(MYLIB.LOADING(),this.casePhone_back_mask=e.product_img_back_mask,this.canvas_back.clear(),fabric.Image.fromURL(e.product_img_back,function(t){i.canvas_back.setWidth(i.widthCanvas),i.canvas_back.setHeight(i.heightCanvas);var n=i.canvas_back.width/t.width;1>n?t.scale(n):n=1,i.casePhone_back=t,i.canvas_back.add(i.casePhone_back),i.casePhone_back.selectable=!1,i.centerX=i.casePhone_back.currentWidth/2,i.centerY=i.casePhone_back.currentHeight/2,i.canvas_back.setOverlayImage(e.product_img_back_mask,i.canvas_back.renderAll.bind(i.canvas_back),{scaleX:n,scaleY:n}),i.canvas_back.setWidth(i.casePhone_back.currentWidth),i.canvas_back.setHeight(i.casePhone_back.currentHeight),i.canvas_back.renderAll(),MYLIB.REMOVE_LOADING()})),this.hasLayerCircle&&(MYLIB.LOADING(),this.casePhone_layerCircle_mask=e.product_layer_circle_mask,this.canvas_layerCircle.clear(),fabric.Image.fromURL(e.product_layer_circle,function(t){i.canvas_layerCircle.setWidth(i.widthCanvas),i.canvas_layerCircle.setHeight(i.heightCanvas);var n=i.canvas_layerCircle.width/t.width;1>n?t.scale(n):n=1,i.casePhone_layerCircle=t,i.canvas_layerCircle.add(i.casePhone_layerCircle),i.casePhone_layerCircle.selectable=!1,i.centerX=i.casePhone_layerCircle.currentWidth/2,i.centerY=i.casePhone_layerCircle.currentHeight/2,i.canvas_layerCircle.setOverlayImage(e.product_layer_circle_mask,i.canvas_layerCircle.renderAll.bind(i.canvas_layerCircle),{scaleX:n,scaleY:n}),i.canvas_layerCircle.setWidth(i.casePhone_layerCircle.currentWidth),i.canvas_layerCircle.setHeight(i.casePhone_layerCircle.currentHeight),i.canvas_layerCircle.renderAll.call(i.canvas_layerCircle),MYLIB.REMOVE_LOADING()}))},CP.MainCanvas.prototype.addTextHandle=function(t){var e=t.data,i=new fabric.IText(e);i.fontSize=CP_INIT.text.fontSize,i.fontFamily=CP_INIT.text.fontFamilyDefault,this.textDict.push(i),this.is_layerCircle?(this.canvas_layerCircle.add(i),this.canvas_layerCircle.centerObject(i),this.canvas_layerCircle.setActiveObject(i),i.setCoords(),this.canvas_layerCircle.renderAll()):this.is_state?(this.canvas.add(i),this.canvas.centerObject(i),this.canvas.setActiveObject(i),i.setCoords(),this.canvas.renderAll()):(this.canvas_back.add(i),this.canvas_back.centerObject(i),this.canvas_back.setActiveObject(i),i.setCoords(),this.canvas_back.renderAll())},CP.MainCanvas.prototype.addImageUploadHandle=function(t){var e=this,i=t.data,n=t.data;MYLIB.eventManager.fireEvent(e,MYLIB.eventNames.event_display_img,n);var o=new Image;o.src=i,MYLIB.LOADING(),o.onload=function(){MYLIB.REMOVE_LOADING();var t=new fabric.Image(o,{centeredScaling:!0,centeredRotation:!0}),i=e.casePhone.currentWidth/o.width;1>i&&t.scale(i>=.5?i-.4:i),e.canvas.getObjects().length,e.is_layerCircle?e.addObjectToCanvas(e.canvas_layerCircle,t):e.is_state?e.addObjectToCanvas(e.canvas,t):e.addObjectToCanvas(e.canvas_back,t)}},CP.MainCanvas.prototype.addImageUploadFormAssetHandle=function(t){var e=this,i=t.data.src,n=t.data.src,o=t.data.id,a=t.data.thumb;MYLIB.eventManager.fireEvent(e,MYLIB.eventNames.event_display_img,n);var s=new Image;s.src=i,MYLIB.LOADING(),s.onload=function(){MYLIB.REMOVE_LOADING();var t=new fabric.Image(s,{centeredScaling:!0,centeredRotation:!0}),n=e.casePhone.currentWidth/s.width;1>n&&t.scale(n>=.5?n-.4:n),e.canvas.getObjects().length,e.is_layerCircle?e.addObjectToCanvas(e.canvas_layerCircle,t):e.is_state?e.addObjectToCanvas(e.canvas,t):e.addObjectToCanvas(e.canvas_back,t),e.assetImgDict&&e.assetImgDict.push({id:o,src:i,thumb:a})}},CP.MainCanvas.prototype.drawShape=function(t){switch(t){case"CIRCLE":var e=this,i=new fabric.Circle({radius:50,borderColor:"#000"});e.is_layerCircle?e.addObjectToCanvas(e.canvas_layerCircle,i):e.is_state?e.addObjectToCanvas(e.canvas,i):e.addObjectToCanvas(e.canvas_back,i);break;case"RECT":var n=new fabric.Rect({originX:"left",originY:"top",width:150,height:120,fill:"green",transparentCorners:!1});this.is_layerCircle?this.addObjectToCanvas(this.canvas_layerCircle,n):this.is_state?this.addObjectToCanvas(this.canvas,n):this.addObjectToCanvas(this.canvas_back,n)}},CP.MainCanvas.prototype.showUpHandle=function(t){this.getActiveObject()&&this.getActiveObject().bringForward()},CP.MainCanvas.prototype.BackToUpHandle=function(){this.getActiveObject()&&this.getActiveObject().sendBackwards()},CP.MainCanvas.prototype.rotateRepeatHandle=function(){this.getActiveObject()&&this.rotateObject(90)},CP.MainCanvas.prototype.rotateObject=function(t){var e=this.getActiveObject(),i=!1;if(e){var n=e.getAngle()+t;"center"===e.originX&&"center"===e.originY||!e.centeredRotation||(e.setOriginToCenter&&e.setOriginToCenter(),i=!0),n=n>360?90:0>n?270:n,e.setAngle(n).setCoords(),i&&e.setCenterToOrigin&&e.setCenterToOrigin(),this.is_layerCircle?this.canvas_layerCircle.renderAll():this.is_state?this.canvas.renderAll():this.canvas_back.renderAll()}},CP.MainCanvas.prototype.saveCanvasHandle=function(t){},CP.MainCanvas.prototype.saveCanvasToSVG=function(t){return this.canvas.deactivateAll().renderAll(),this.canvas.item(1).toSVG()},CP.MainCanvas.prototype.saveCanvasToImg=function(t){return this.canvas.deactivateAll().renderAll(),this.canvas.toSVG(),this.canvas.toDataURL()},CP.MainCanvas.prototype.saveCanvasBackToImg=function(t){return this.canvas_back.deactivateAll().renderAll(),this.canvas_back.toSVG(),this.canvas_back.toDataURL()},CP.MainCanvas.prototype.saveLayerCircleCanvasToImg=function(){return this.canvas_layerCircle.deactivateAll().renderAll(),this.canvas_layerCircle.toSVG(),this.canvas_layerCircle.toDataURL()},CP.MainCanvas.prototype.getImageFrontToPrint=function(t){this.canvas.deactivateAll().renderAll(),this.canvas.setOverlayImage(null),this.canvas.remove(this.canvas.item(0));var e=this.canvas.toDataURL({format:"png",multiplier:2});return e},CP.MainCanvas.prototype.getImageBackToPrint=function(t){this.canvas_back.deactivateAll().renderAll(),this.canvas_back.setOverlayImage(null),this.canvas_back.remove(this.canvas_back.item(0));var e=this.canvas_back.toDataURL({format:"png",multiplier:2});return e},CP.MainCanvas.prototype.getImgLayerCircleToPrint=function(t){this.canvas_layerCircle.deactivateAll().renderAll(),this.canvas_layerCircle.setOverlayImage(null),this.canvas_layerCircle.remove(this.canvas_layerCircle.item(0));var e=this.canvas_layerCircle.toDataURL({format:"png",multiplier:2});return e},CP.MainCanvas.prototype.zoomHandle=function(t){var e=t,i=this.getActiveObject();if(i)switch(e){case"ZOOMIN":var n=i.getScaleX();i.scale(parseFloat(n+.05)).setCoords(),this.is_layerCircle?this.canvas_layerCircle.renderAll():this.is_state?this.canvas.renderAll():this.canvas_back.renderAll();break;case"ZOOMOUT":var n=i.getScaleX();i.scale(parseFloat(n-.05)).setCoords(),this.is_layerCircle?this.canvas_layerCircle.renderAll():this.is_state?this.canvas.renderAll():this.canvas_back.renderAll()}},CP.MainCanvas.prototype.rotateHandle=function(t){var e=t,i=this.getActiveObject();if(i)switch(e){case"ROTATELEFT":var n=i.getAngle();i.setAngle(parseInt(n-10)).setCoords(),this.is_layerCircle?this.canvas_layerCircle.renderAll():this.is_state?this.canvas.renderAll():this.canvas_back.renderAll();break;case"ROTATERIGHT":var n=i.getAngle();i.setAngle(parseInt(n+10)).setCoords(),this.is_state?this.canvas.renderAll():this.canvas_back.renderAll()}},CP.MainCanvas.prototype.changeFontHandle=function(t){var e=this.getActiveObject(),i=t.data;e.fontFamily=i,this.is_layerCircle?this.canvas_layerCircle.renderAll():this.is_state?this.canvas.renderAll():this.canvas_back.renderAll()},CP.MainCanvas.prototype.changeFontWeightHandle=function(t){var e=this.getActiveObject(),i=t.data;e.fontWeight=i,this.is_layerCircle?this.canvas_layerCircle.renderAll():this.is_state?this.canvas.renderAll():this.canvas_back.renderAll()},CP.MainCanvas.prototype.changeOpacityHandle=function(t){var e=t.data,i=this.getActiveObject();i&&(i.opacity=e/100,this.is_layerCircle?this.canvas_layerCircle.renderAll():this.is_state?this.canvas.renderAll():this.canvas_back.renderAll())},CP.MainCanvas.prototype.switchDrawModeHandle=function(t){var e=t.data;this.canvas.isDrawingMode=e,this.hasBack&&(this.canvas_back.isDrawingMode=e),this.hasLayerCircle&&(this.canvas_layerCircle.isDrawingMode=e)},CP.MainCanvas.prototype.freeDrawHandle=function(t){var e=t.data;this.is_layerCircle?(this.canvas_layerCircle.freeDrawingBrush=new fabric[e+"Brush"](this.canvas_layerCircle),this.canvas_layerCircle.freeDrawingBrush.width=parseInt(this.lineWidth,10)||1,this.canvas_layerCircle.freeDrawingBrush.color=this.lineColor):this.is_state?(this.canvas.freeDrawingBrush=new fabric[e+"Brush"](this.canvas),this.canvas.freeDrawingBrush.width=parseInt(this.lineWidth,10)||1,this.canvas.freeDrawingBrush.color=this.lineColor):(this.canvas_back.freeDrawingBrush=new fabric[e+"Brush"](this.canvas_back),this.canvas_back.freeDrawingBrush.width=parseInt(this.lineWidth,10)||1,this.canvas_back.freeDrawingBrush.color=this.lineColor)},CP.MainCanvas.prototype.setLineWidthFreeDrawHandle=function(t){var e=t.data;this.lineWidth=e,this.is_layerCircle?this.canvas_layerCircle.freeDrawingBrush.width=parseInt(this.lineWidth,10)||1:this.is_state?this.canvas.freeDrawingBrush.width=parseInt(this.lineWidth,10)||1:this.canvas_back.freeDrawingBrush.width=parseInt(this.lineWidth,10)||1},CP.MainCanvas.prototype.setLineColorFreeDrawHandle=function(t){var e=t.data;this.lineColor=e,this.is_layerCircle?this.canvas_layerCircle.freeDrawingBrush.color=this.lineColor:this.is_state?this.canvas.freeDrawingBrush.color=this.lineColor:this.canvas_back.freeDrawingBrush.color=this.lineColor},CP.MainCanvas.prototype.changePartternHandle=function(t){var e=t.data,i=this.getActiveObject(),n=new Image;n.src=e,MYLIB.LOADING();var o=this;n.onload=function(){n.width=i.width;var t=new fabric.Pattern({source:n,repeat:"repeat"});i.fontSize=250,i.fill=t,o.is_layerCircle?(o.canvas_layerCircle.setActiveObject(i),i.scale(.2),o.canvas_layerCircle.renderAll()):o.is_state?(o.canvas.setActiveObject(i),i.scale(.2),o.canvas.renderAll()):(o.canvas_back.setActiveObject(i),i.scale(.2),o.canvas_back.renderAll()),MYLIB.REMOVE_LOADING()}},CP.MainCanvas.prototype.curveTextHandle=function(){this.getActiveObject()},CP.MainCanvas.prototype.getItemFromCanvas=function(){var t=[],e=[],i=[];t=this.canvas.toJSON(),this.hasBack&&(e=this.canvas_back.toJSON()),this.hasLayerCircle&&(i=this.canvas_layerCircle.toJSON());var n={front:t,back:e,layerCircle:i};return n},CP.MainCanvas.prototype.loadTemplateToCanvas=function(e){var i=this,n=MYLIB.getParamURL("ref"),o=new CP.OrdersSerice;o.param.data={id:n};var a=o.getTemplateOrder(),i=this;MYLIB.LOADING(),a.done(function(e){t.getJSON(MYLIB.IMAGEHOST+e.json,function(t,e){MYLIB.LOADING(),0!=_.size(t.front)&&(t.front.objects.unshift(i.casePhone.toObject()),i.canvas.loadFromJSON(t.front,function(){i.canvas.renderAll.call(i.canvas),i.canvas.item(0).selectable=!1,i.applyImageFilters(i.canvas)},function(t,e){})),i.hasBack&&0!=_.size(t.back)&&(t.back.objects.unshift(i.casePhone_back.toObject()),i.canvas_back.loadFromJSON(t.back,function(){i.canvas_back.renderAll.call(i.canvas_back),i.canvas_back.item(0).selectable=!1,i.applyImageFilters(i.canvas_back)},function(t,e){})),i.hasLayerCircle&&0!=_.size(t.layerCircle)&&_.size(t.layerCircle.objects)>2&&(t.layerCircle.objects.unshift(i.casePhone_layerCircle.toObject()),i.canvas_layerCircle.loadFromJSON(t.layerCircle,function(){i.canvas_layerCircle.renderAll.call(i.canvas_layerCircle),i.canvas_layerCircle.item(0).selectable=!1,_.size(t.layerCircle.objects)>2&&i.$elDriectionProductLayerCircle.trigger("click"),i.applyImageFilters(i.canvas_layerCircle)},function(t,e){})),MYLIB.REMOVE_LOADING()})})},CP.MainCanvas.prototype.applyImageFilters=function(t){t.forEachObject(function(t){"image"===t.type&&t.filters.length&&t.applyFilters(function(){t.canvas.renderAll()})})},CP.MainCanvas.prototype.addObjectToCanvas=function(t,e){t.add(e),e.set({borderColor:"gray",cornerColor:"black",cornerSize:16,transparentCorners:!0}),t.centerObject(e),t.setActiveObject(e),e.setCoords(),t.renderAll()},MYLIB.mixin(CP.MainCanvas,MYLIB.Event.ObserverMixin)}(jQuery,window,document),!function(t,e,i,n){CP.ChooseProduct=function(){var e='<div data-step="1" data-intro="Chọn sản phẩm!" id="{0}"" class="{1}" style="margin-bottom: 10px;width:100%;overflow-x:auto"><div class="content-product-list" style="min-width: 1500px;"></div></div>';this.$el=null,this.productService=null,this.data=null,this.productItems=[],this.init=function(){e=e.format(MYLIB.constant.choose_product_id,MYLIB.constant.choose_product_class),this.$el=t(e),this.productService=new CP.productSerice,this.renderProduct()},this.initSpecificProduct=function(i){e=e.format(MYLIB.constant.choose_product_id,MYLIB.constant.choose_product_class),this.$el=t(e),this.productService=new CP.productSerice,this.renderProducSpecificProduct(i)},this.getElement=function(){return this.$el}},CP.ChooseProduct.prototype.productDicts=[],CP.ChooseProduct.prototype.renderProduct=function(){var t=this,e=this.productService.getProducts(4);MYLIB.LOADING_LITTLE(t.$el,"loading.."),e.done(function(e){t.data=e.products,t.render(t.data),MYLIB.REMOVE_LOADING_LITTLE(t.$el)})},CP.ChooseProduct.prototype.renderProducSpecificProduct=function(t){var e=this,i=this.productService.getSpecificProducts(t);MYLIB.LOADING_LITTLE(e.$el,"loading.."),i.done(function(t){e.data=t.products,e.render(e.data),MYLIB.REMOVE_LOADING_LITTLE(e.$el)})},CP.ChooseProduct.prototype.render=function(t){var e=this,i=(t[0],""!==t[0].product_title_seo?t[0].product_title_seo:t[0].product_name);MYLIB.setSEOOnPage(i,t[0].product_desc_seo);var n=e.$el.find(".content-product-list");_.each(t,function(t,i,o){var a=new CP.ProductItem;a.init(t),n.append(a.getElement()),e.productItems.push(a)});var o=this.productItems[0];o.$el.trigger("click")}}(jQuery,window,document),function(t,e,i,n){CP.ProductItem=function(){},CP.ProductItem.prototype.$el=null,CP.ProductItem.prototype.data=null,CP.ProductItem.prototype.html='<div class="product-item"></div>',CP.ProductItem.prototype.active=!1,CP.ProductItem.prototype.init=function(e){this.$el=t(this.html);var i='<div class="title_product">{0}</div>',n='<div class="img_product">{0}</div>',o='<img src="{0}" class="img-responsive" />';i=i.format(e.product_name),o=o.format(MYLIB.IMAGEHOST+e.product_img_thumb),n=n.format(o),this.data=e,this.data.product_img_primary=MYLIB.IMAGEHOST+e.product_img_primary,this.data.product_img_primary_mask=MYLIB.IMAGEHOST+e.product_img_primary_mask,this.data.product_img_thumb=MYLIB.IMAGEHOST+e.product_img_thumb,this.data.product_img_back=MYLIB.IMAGEHOST+e.product_img_back,this.data.product_img_back_mask=MYLIB.IMAGEHOST+e.product_img_back_mask,this.data.product_layer_circle=MYLIB.IMAGEHOST+e.product_layer_circle,this.data.product_layer_circle_mask=MYLIB.IMAGEHOST+e.product_layer_circle_mask,this.$el.append(n),this.$el.append(i),this.bindEvent()},CP.ProductItem.prototype.getElement=function(){return this.$el},CP.ProductItem.prototype.bindEvent=function(){this.$el.unbind("click touchstart",this.chooseProductHandle).bind("click touchstart",this,this.chooseProductHandle)},CP.ProductItem.prototype.chooseProductHandle=function(e){var i=e.data;t(".product-item").removeClass("active"),i.$el.toggleClass("active"),MYLIB.eventManager.fireEvent(i,MYLIB.eventNames.chooseProductItem,i.data)},MYLIB.mixin(CP.ProductItem,MYLIB.Event.ObserverMixin)}(jQuery,window,document),!function(t,e,i,n){function o(t){return t=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),a(t[1])+a(t[2])+a(t[3])}function a(t){return isNaN(t)?"00":s[(t-t%16)/16]+s[t%16]}CP.ColorModuleHorizontal=function(){this.$el=null,this.viewPath=MYLIB.mainUrl+"js/module/color.horizontal.module/view/tmp.html",this.$listColor=null,this.$elCirleResult=null},CP.ColorModuleHorizontal.prototype.init=function(e){var i=this;t.get(this.viewPath,function(o){var a=t(o).html(),s=Handlebars.compile(a);i.$el=t(s()),i.$listColor=t(i.$el[2]).find("#color-horizontal-module-main"),i.$elCirleResult=t(i.$el[2]).find(".circle-result"),i.bindEvent(),e!=n&&"function"==typeof e&&e.call(i)})},CP.ColorModuleHorizontal.prototype.bindEvent=function(){var e=this;this.$elCirleResult.parent().draggable({axis:"x",grid:[20,0],drag:function(t,e){return e.position.left<=-10?(e.position.left=0,!1):e.position.left>540?(e.position.left=540,!1):void 0},stop:function(t,i){var n=Math.round(i.position.left/20),o=e.$listColor.find("li").eq(n).find("div");e.applyResult(o)}}),this.$listColor.find("li").click(function(i){var n=t(this).find("div");e.applyResult(n)})};var s=new Array("0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f");CP.ColorModuleHorizontal.prototype.applyResult=function(t){var e=this,i=t.position();this.$elCirleResult.css({background:t.css("background-color")}),this.$elCirleResult.parent().css({left:i.left-10}),MYLIB.eventManager.fireEvent(e,MYLIB.eventNames.event_change_color,o(t.css("background-color")))}}(jQuery,window,document),!function(t,e,i,n){CP.ColorController=function(){this.view=null,this.model=null},CP.ColorController.prototype.init=function(){this.view=new CP.ColorView,this.view.init(),this.model=new CP.ColorModel,this.model.init(),this.view.render([this.model.HEADING,this.model.ID_INPUT,this.model.NAME_INPUT]),this.bindEvent()},CP.ColorController.prototype.bindEvent=function(){this.view.bindEvent(this)},CP.ColorController.prototype.changeColorHandle=function(e){var i=e.data,n=t(e.currentTarget),o=n.val();MYLIB.eventManager.fireEvent(i,MYLIB.eventNames.event_change_color,o)},MYLIB.mixin(CP.ColorController,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.ColorModule=function(){this.controller=null},CP.ColorModule.prototype.init=function(){this.controller=new CP.ColorController,this.controller.init()},MYLIB.mixin(CP.ColorModule,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.ColorModel=function(){this.ID_INPUT="input-color-picker",this.NAME_INPUT="input-color-picker",this.HEADING="Chọn màu sắc"},CP.ColorModel.prototype.init=function(){return!0},CP.ColorModel.prototype.getElement=function(){},CP.ColorModel.prototype.bindEvent=function(){},MYLIB.mixin(CP.ColorView,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.ColorView=function(){this.html="",this.$el=null,this.$input=null,this.init=function(){this.html='<div data-step="6" data-intro="Sau khi thêm chữ, các bạn có thể chọn màu sắc cho chữ" class="panel panel-default"><div class="panel-heading"><i class="ion-ios-color-filter size-18"></i> {0}</div><div class="panel-body"><input id="{1}" type="text" value="000" name="{2}" class="pick-a-color form-control">'}},CP.ColorView.prototype.render=function(e){
if(!t.isArray(e))throw"Data render must be array";this.html=this.html.format(e[0],e[1],e[2]),this.$el=t(this.html),this.$input=this.$el.find("#"+e[1])},CP.ColorView.prototype.getElement=function(){return this.$el},CP.ColorView.prototype.bindEvent=function(t){this.$input.pickAColor(),this.$input.unbind("change").bind("change",t,t.changeColorHandle)},MYLIB.mixin(CP.ColorView,MYLIB.Event.ObserverMixin)}(jQuery,window,document),!function(t,e,i,n){CP.CropImageModule=function(t){this.viewPath="js/module/crop.image.module/view/template.html",this.darkRoom=null,this.callbackDashboard=t},MYLIB.extend(CP.CropImageModule,CP.PopupModule),CP.CropImageModule.prototype.init=function(){this.titlePopup="CROP HÌNH",this.parent.proto.init.call(this),this.$el.appendTo("body"),this.render()},CP.CropImageModule.prototype.getElement=function(){return this.$el},CP.CropImageModule.prototype.render=function(){var e=this;t.get(this.viewPath,function(i){var n=t(i).html(),o=Handlebars.compile(n),a=o();e.$elContent.append(t(a)),e.initElement.call(e),e.bindEvent()})},CP.CropImageModule.prototype.initElement=function(){},CP.CropImageModule.prototype.bindEvent=function(){},CP.CropImageModule.prototype.show=function(e){this.$el.find("#body-crop-img").html("");var i=t('<img src="" id="img-tmp" style="width : 100%"/>');i.attr("src",e),this.$el.find("#body-crop-img").append(i);var n=this;this.darkRoom=new Darkroom("#img-tmp",{crop:{ratio:100},covertToMainCanvasInqua:function(){n.callbackDashboard.appleEffectImg.call(n.callbackDashboard,this.snapshotImage()),n.hide()}}),this.$el.modal("show")},MYLIB.mixin(CP.PopupAssetsModule,MYLIB.Event.ObserverMixin)}(jQuery,window,document),!function(t,e,i,n){"use strict";var o=n.util.createClass(n.Rect,{_render:function(t){this.callSuper("_render",t);var e=(t.canvas,7),i=this.flipX?-1:1,n=this.flipY?-1:1,o=i/this.scaleX,a=n/this.scaleY;t.scale(o,a),t.fillStyle="rgba(0, 0, 0, 0.5)",this._renderOverlay(t),void 0!==t.setLineDash?t.setLineDash([e,e]):void 0!==t.mozDash&&(t.mozDash=[e,e]),t.strokeStyle="rgba(0, 0, 0, 0.2)",this._renderBorders(t),this._renderGrid(t),t.lineDashOffset=e,t.strokeStyle="rgba(255, 255, 255, 0.4)",this._renderBorders(t),this._renderGrid(t),t.scale(1/o,1/a)},_renderOverlay:function(t){var e=t.canvas,i=0,n=Math.ceil(-this.getWidth()/2-this.getLeft()),o=Math.ceil(-this.getWidth()/2),a=Math.ceil(this.getWidth()/2),s=Math.ceil(this.getWidth()/2+(e.width-this.getWidth()-this.getLeft())),r=Math.ceil(-this.getHeight()/2-this.getTop()),l=Math.ceil(-this.getHeight()/2),c=Math.ceil(this.getHeight()/2),h=Math.ceil(this.getHeight()/2+(e.height-this.getHeight()-this.getTop()));t.fillRect(n,r,s-n,l-r+i),t.fillRect(n,l,o-n,c-l+i),t.fillRect(a,l,s-a,c-l+i),t.fillRect(n,c,s-n,h-c)},_renderBorders:function(t){t.beginPath(),t.moveTo(-this.getWidth()/2,-this.getHeight()/2),t.lineTo(this.getWidth()/2,-this.getHeight()/2),t.lineTo(this.getWidth()/2,this.getHeight()/2),t.lineTo(-this.getWidth()/2,this.getHeight()/2),t.lineTo(-this.getWidth()/2,-this.getHeight()/2),t.stroke()},_renderGrid:function(t){t.beginPath(),t.moveTo(-this.getWidth()/2+1/3*this.getWidth(),-this.getHeight()/2),t.lineTo(-this.getWidth()/2+1/3*this.getWidth(),this.getHeight()/2),t.stroke(),t.beginPath(),t.moveTo(-this.getWidth()/2+2/3*this.getWidth(),-this.getHeight()/2),t.lineTo(-this.getWidth()/2+2/3*this.getWidth(),this.getHeight()/2),t.stroke(),t.beginPath(),t.moveTo(-this.getWidth()/2,-this.getHeight()/2+1/3*this.getHeight()),t.lineTo(this.getWidth()/2,-this.getHeight()/2+1/3*this.getHeight()),t.stroke(),t.beginPath(),t.moveTo(-this.getWidth()/2,-this.getHeight()/2+2/3*this.getHeight()),t.lineTo(this.getWidth()/2,-this.getHeight()/2+2/3*this.getHeight()),t.stroke()}});i.plugins.crop=i.Plugin.extend({startX:null,startY:null,isKeyCroping:!1,isKeyLeft:!1,isKeyUp:!1,defaults:{minHeight:1,minWidth:1,ratio:null,quickCropKey:!1},initialize:function(){var t=this.darkroom.toolbar.createButtonGroup();this.cropButton=t.createButton({image:"crop"}," Cắt hình"),this.okButton=t.createButton({image:"accept",type:"success",hide:!0}," Ok"),this.cancelButton=t.createButton({image:"cancel",type:"danger",hide:!0}," Hủy"),this.cropButton.addEventListener("click",this.toggleCrop.bind(this)),this.okButton.addEventListener("click",this.cropCurrentZone.bind(this)),this.cancelButton.addEventListener("click",this.releaseFocus.bind(this)),this.darkroom.canvas.on("mouse:down",this.onMouseDown.bind(this)),this.darkroom.canvas.on("mouse:move",this.onMouseMove.bind(this)),this.darkroom.canvas.on("mouse:up",this.onMouseUp.bind(this)),this.darkroom.canvas.on("object:moving",this.onObjectMoving.bind(this)),this.darkroom.canvas.on("object:scaling",this.onObjectScaling.bind(this)),n.util.addListener(n.document,"keydown",this.onKeyDown.bind(this)),n.util.addListener(n.document,"keyup",this.onKeyUp.bind(this)),this.darkroom.addEventListener("image:change",this.releaseFocus.bind(this))},onObjectMoving:function(t){if(this.hasFocus()){var e=t.target;if(e===this.cropZone){var i=this.darkroom.canvas,n=e.getLeft(),o=e.getTop(),a=e.getWidth(),s=e.getHeight(),r=i.getWidth()-a,l=i.getHeight()-s;0>n&&e.set("left",0),0>o&&e.set("top",0),n>r&&e.set("left",r),o>l&&e.set("top",l),this.darkroom.dispatchEvent("crop:update")}}},onObjectScaling:function(t){if(this.hasFocus()){var e=!1,i=t.target;if(i===this.cropZone){var n=this.darkroom.canvas,o=n.getPointer(t.e),a=(o.x,o.y,i.getLeft()),s=i.getTop(),r=i.getLeft()+i.getWidth(),l=i.getTop()+i.getHeight();if(null!==this.options.ratio&&(0>a||r>n.getWidth()||0>s||l>n.getHeight())&&(e=!0),0>a||r>n.getWidth()||e){var c=this.lastScaleX||1;i.setScaleX(c)}if(0>a&&i.setLeft(0),0>s||l>n.getHeight()||e){var h=this.lastScaleY||1;i.setScaleY(h)}0>s&&i.setTop(0),i.getWidth()<this.options.minWidth&&i.scaleToWidth(this.options.minWidth),i.getHeight()<this.options.minHeight&&i.scaleToHeight(this.options.minHeight),this.lastScaleX=i.getScaleX(),this.lastScaleY=i.getScaleY(),this.darkroom.dispatchEvent("crop:update")}}},onMouseDown:function(t){if(this.hasFocus()){var e=this.darkroom.canvas;e.calcOffset();var i=e.getPointer(t.e),o=i.x,a=i.y,s=new n.Point(o,a),r=e.getActiveObject();r===this.cropZone||this.cropZone.containsPoint(s)||(e.discardActiveObject(),this.cropZone.setWidth(0),this.cropZone.setHeight(0),this.cropZone.setScaleX(1),this.cropZone.setScaleY(1),this.startX=o,this.startY=a)}},onMouseMove:function(t){if(this.isKeyCroping)return this.onMouseMoveKeyCrop(t);if(null!==this.startX&&null!==this.startY){var e=this.darkroom.canvas,i=e.getPointer(t.e),n=i.x,o=i.y;this._renderCropZone(this.startX,this.startY,n,o)}},onMouseMoveKeyCrop:function(t){var e=this.darkroom.canvas,i=this.cropZone,n=e.getPointer(t.e),o=n.x,a=n.y;i.left&&i.top||(i.setTop(a),i.setLeft(o)),this.isKeyLeft=o<i.left+i.width/2,this.isKeyUp=a<i.top+i.height/2,this._renderCropZone(Math.min(i.left,o),Math.min(i.top,a),Math.max(i.left+i.width,o),Math.max(i.top+i.height,a))},onMouseUp:function(t){if(null!==this.startX&&null!==this.startY){var e=this.darkroom.canvas;this.cropZone.setCoords(),e.setActiveObject(this.cropZone),e.calcOffset(),this.startX=null,this.startY=null}},onKeyDown:function(t){!1===this.options.quickCropKey||t.keyCode!==this.options.quickCropKey||this.isKeyCroping||(this.isKeyCroping=!0,this.darkroom.canvas.discardActiveObject(),this.cropZone.setWidth(0),this.cropZone.setHeight(0),this.cropZone.setScaleX(1),this.cropZone.setScaleY(1),this.cropZone.setTop(0),this.cropZone.setLeft(0))},onKeyUp:function(t){!1!==this.options.quickCropKey&&t.keyCode===this.options.quickCropKey&&this.isKeyCroping&&(this.isKeyCroping=!1,this.startX=1,this.startY=1,this.onMouseUp())},selectZone:function(t,e,i,n,o){this.hasFocus()||this.requireFocus(),o?this.cropZone.set({left:t,top:e,width:i,height:n}):this._renderCropZone(t,e,t+i,e+n);var a=this.darkroom.canvas;a.bringToFront(this.cropZone),this.cropZone.setCoords(),a.setActiveObject(this.cropZone),a.calcOffset(),this.darkroom.dispatchEvent("crop:update")},toggleCrop:function(){this.hasFocus()?this.releaseFocus():this.requireFocus()},cropCurrentZone:function(){if(this.hasFocus()&&!(this.cropZone.width<1&&this.cropZone.height<1)){var t=this,e=this.darkroom,i=e.canvas;this.cropZone.visible=!1;var o=new Image;o.onload=function(){if(!(this.height<1||this.width<1)){var o=new n.Image(this,{selectable:!1,evented:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1}),a=(this.width,this.height);if(i.setHeight(a),t.darkroom.image.remove(),t.darkroom.image=o,i.getWidth()<o.width){var s=i.getWidth()/o.width;o.scale(s>=.5?s-.4:s)}i.add(o),e.dispatchEvent("image:change")}},o.src=i.toDataURL({left:this.cropZone.getLeft()+5,top:this.cropZone.getTop()+5,width:this.cropZone.getWidth()-10,height:this.cropZone.getHeight()-10,multiplier:5})}},hasFocus:function(){return void 0!==this.cropZone},requireFocus:function(){this.cropZone=new o({fill:"transparent",hasBorders:!1,originX:"left",originY:"top",cornerColor:"#444",cornerSize:8,transparentCorners:!1,lockRotation:!0,hasRotatingPoint:!1}),null!==this.options.ratio&&this.cropZone.set("lockUniScaling",!0),this.darkroom.canvas.add(this.cropZone),this.darkroom.canvas.defaultCursor="crosshair",this.cropButton.active(!0),this.okButton.hide(!1),this.cancelButton.hide(!1)},releaseFocus:function(){void 0!==this.cropZone&&(this.cropZone.remove(),this.cropZone=void 0,this.cropButton.active(!1),this.okButton.hide(!0),this.cancelButton.hide(!0),this.darkroom.canvas.defaultCursor="default",this.darkroom.dispatchEvent("crop:update"))},_renderCropZone:function(t,e,i,n){var o=this.darkroom.canvas,a=i>t,s=!a,r=n>e,l=!r,c=Math.min(+this.options.minWidth,o.getWidth()),h=Math.min(+this.options.minHeight,o.getHeight()),d=Math.min(t,i),u=Math.max(t,i),p=Math.min(e,n),v=Math.max(e,n);d=Math.max(0,d),u=Math.min(o.getWidth(),u),p=Math.max(0,p),v=Math.min(o.getHeight(),v),c>u-d&&(a?u=d+c:d=u-c),h>v-p&&(r?v=p+h:p=v-h),0>d&&(u+=Math.abs(d),d=0),u>o.getWidth()&&(d-=u-o.getWidth(),u=o.getWidth()),0>p&&(v+=Math.abs(p),p=0),v>o.getHeight()&&(p-=v-o.getHeight(),v=o.getHeight());var m=u-d,C=v-p,f=m/C;if(this.options.ratio&&+this.options.ratio!==f){var g=+this.options.ratio;if(this.isKeyCroping&&(s=this.isKeyLeft,l=this.isKeyUp),g>f){var b=C*g;s&&(d-=b-m),m=b}else if(f>g){var y=C/(g*C/m);l&&(p-=y-C),C=y}if(0>d&&(d=0),0>p&&(p=0),d+m>o.getWidth()){var b=o.getWidth()-d;C=b*C/m,m=b,l&&(p=e-C)}if(p+C>o.getHeight()){var y=o.getHeight()-p;m=m*y/C,C=y,s&&(d=t-m)}}this.cropZone.left=d,this.cropZone.top=p,this.cropZone.width=m,this.cropZone.height=C,this.darkroom.canvas.bringToFront(this.cropZone),this.darkroom.dispatchEvent("crop:update")}})}(window,document,Darkroom,fabric),function(t,e,i,n){"use strict";i.plugins.history=i.Plugin.extend({initialize:function(){this._initButtons(),this.backHistoryStack=[],this.forwardHistoryStack=[],this._snapshotImage(),this.darkroom.addEventListener("image:change",this._onImageChange.bind(this))},goBack:function(){0!==this.backHistoryStack.length&&(this.forwardHistoryStack.push(this.currentImage),this.currentImage=this.backHistoryStack.pop(),this._applyImage(this.currentImage),this._updateButtons(),this.darkroom.dispatchEvent("history:navigate"))},goForward:function(){0!==this.forwardHistoryStack.length&&(this.backHistoryStack.push(this.currentImage),this.currentImage=this.forwardHistoryStack.pop(),this._applyImage(this.currentImage),this._updateButtons(),this.darkroom.dispatchEvent("history:navigate"))},_initButtons:function(){var t=this.darkroom.toolbar.createButtonGroup();return this.backButton=t.createButton({image:"back",disabled:!0}),this.forwardButton=t.createButton({image:"forward",disabled:!0}),this.backButton.addEventListener("click",this.goBack.bind(this)),this.forwardButton.addEventListener("click",this.goForward.bind(this)),this},_updateButtons:function(){this.backButton.disable(0===this.backHistoryStack.length),this.forwardButton.disable(0===this.forwardHistoryStack.length)},_snapshotImage:function(){var t=new Image;t.src=this.darkroom.snapshotImage(),this.currentImage=t},_onImageChange:function(){this.backHistoryStack.push(this.currentImage),this._snapshotImage(),this.forwardHistoryStack.length=0,this._updateButtons()},_applyImage:function(t){var e=this.darkroom.canvas,i=new n.Image(t,{selectable:!1,evented:!1,lockMovementX:!0,lockMovementY:!0,lockRotation:!0,lockScalingX:!0,lockScalingY:!0,lockUniScaling:!0,hasControls:!1,hasBorders:!1});e.setWidth(t.width),e.setHeight(t.height),this.darkroom.image.remove(),this.darkroom.image=i,e.add(i)}})}(window,document,Darkroom,fabric),function(t,e,i,n){"use strict";i.plugins.rotate=i.Plugin.extend({initialize:function(){var t=this.darkroom.toolbar.createButtonGroup();this.leftButton=t.createButton({image:"rotate-left"}),this.rightButton=t.createButton({image:"rotate-right"}),this.leftButton.addEventListener("click",this.rotateLeft.bind(this)),this.rightButton.addEventListener("click",this.rotateRight.bind(this))},rotateLeft:function(){this.rotate(-90)},rotateRight:function(){this.rotate(90)},rotate:function(t){var e=this.darkroom,i=e.canvas,n=e.image;t=(n.getAngle()+t)%360;var o,a;a=Math.abs(n.getWidth()*Math.sin(t*Math.PI/180))+Math.abs(n.getHeight()*Math.cos(t*Math.PI/180)),o=Math.abs(n.getHeight()*Math.sin(t*Math.PI/180))+Math.abs(n.getWidth()*Math.cos(t*Math.PI/180)),i.setWidth(o),i.setHeight(a),n.rotate(t),i.centerObject(n),n.setCoords(),i.renderAll(),e.dispatchEvent("image:change")}})}(window,document,Darkroom,fabric),function(t,e,i){"use strict";i.plugins.save=i.Plugin.extend({defaults:{convertToCanvasInqua:function(){this.darkroom.covertToMainCanvasInqua()}},initialize:function(){var t=this.darkroom.toolbar.createButtonGroup();this.saveToMainCanvas=t.createButton({image:""},"Chuyển hình vào sản phẩm"),this.saveToMainCanvas.addEventListener("click",this.options.convertToCanvasInqua.bind(this))}})}(window,document,Darkroom),!function(t,e,i,n){CP.EditImgsModule=function(t){this.viewPath="js/module/edit.imgs.module/view/template.html",this.imgOriginal=null,this.imgWrapper=null,this.listLiEffect=null,this.btnApply=null,this.callbackDashboard=t},MYLIB.extend(CP.EditImgsModule,CP.PopupModule),CP.EditImgsModule.prototype.init=function(){this.titlePopup="Chỉnh sửa hình ảnh",this.parent.proto.init.call(this),this.$el.appendTo("body"),this.render()},CP.EditImgsModule.prototype.getElement=function(){return this.$el},CP.EditImgsModule.prototype.render=function(){var e=this;t.get(this.viewPath,function(i){var n=t(i).html(),o=Handlebars.compile(n),a=o();e.$elContent.append(t(a)),e.initElement.call(e),e.bindEvent()})},CP.EditImgsModule.prototype.initElement=function(){this.imgWrapper=this.$elContent.find(".img-result"),this.listLiEffect=this.$elContent.find(".effect-zone li"),this.btnApply=this.$elContent.find(".apply-effect")},CP.EditImgsModule.prototype.bindEvent=function(){this.listLiEffect.bind("click",this.imgsApplyEffectHandle.bind(this)),this.btnApply.bind("click",this.applyImageToCanvas.bind(this))},CP.EditImgsModule.prototype.applyImageToCanvas=function(){this.callbackDashboard.appleEffectImg.call(this.callbackDashboard,this.imgOriginal.attr("src")),this.hide()},CP.EditImgsModule.prototype.imgsApplyEffectHandle=function(e){this.listLiEffect.removeClass("active"),t(e.currentTarget).addClass("active");var i=t(e.currentTarget).data("type");this.imgOriginal.vintage();var n=this.imgOriginal.data("vintageJS");n.reset(),n.apply(),n.vintage(vintagePresets[i])},CP.EditImgsModule.prototype.show=function(e){var i='<img src="{0}" style="width:100%"/>';i=i.format(e),this.imgWrapper.html(""),this.imgOriginal=t(i),this.imgWrapper.append(this.imgOriginal),this.$el.modal("show")},MYLIB.mixin(CP.PopupAssetsModule,MYLIB.Event.ObserverMixin)}(jQuery,window,document),!function(t,e,i,n){CP.FacebookLoginModule=function(t){this.$el=null,this.parent=t,this.htmlNotAuth='<div id="facebook-login-zone"><span class="btn btn-primary" style="margin: 0px;" onclick="CP.FacebookService.getInstance.loginFacebook()"><i class="fa fa-facebook size-18" style="color:#fff"></i> Đăng nhập với Facebook - CYW</span><hr/></div>',this.htmlAuth='<div id="facebook-login-zone" style="text-align:center;padding:10px;background:#45619D;color:#fafafa;margin-bottom:10px;-webkit-box-shadow: -10px 9px 0px -2px rgba(255,213,0,1);-moz-box-shadow: -10px 9px 0px -2px rgba(255,213,0,1);box-shadow: -10px 9px 0px -2px rgba(255,213,0,1);"><div style="width:70px;overflow:hidden; display: inline-block;"><i class="fa fa-facebook size-32" style="color:#fff;position: absolute;"></i><a href="profile.html" style="color:#fff"><img class="img-profile" src="" style="width:100%"/></a></div><br/>Chào :<b><a href="profile.html" style="color:#fff"><span class="username"> </span></a></b><br/><span class="btn btn-primary bnt-logout"> Log out </span></div>'},CP.FacebookLoginModule.prototype.init=function(t){if("undefined"!=typeof FB)this.renderLayout(t);else var i=this,n=setInterval(function(){"undefined"!=typeof FB&&(FB.Event.subscribe("auth.statusChange",i.auth_status_change_callback.bind(i)),i.renderLayout(t),e.clearInterval(n))},1e3)},CP.FacebookLoginModule.prototype.renderLayout=function(t){CP.FacebookService.getInstance.checkLogin(this.renderLayoutAuth.bind(this,t),this.renderLayoutNotAuth.bind(this,t),this.renderLayoutNotAuth.bind(this,t))},CP.FacebookLoginModule.prototype.logout=function(){FB.logout(function(t){})},CP.FacebookLoginModule.prototype.renderLayoutNotAuth=function(e){this.$el=t(this.htmlNotAuth),e()},CP.FacebookLoginModule.prototype.renderLayoutAuth=function(e){this.$el=t(this.htmlAuth);var i=this;CP.FacebookService.getInstance.getInfo(function(t){i.$el.find(".username").html(t.name)}),FB.api("/me/picture?type=large",function(t){i.$el.find(".img-profile").attr("src",t.data.url)}),this.$el.find(".bnt-logout").click(function(t){i.logout()}),e()},CP.FacebookLoginModule.prototype.auth_status_change_callback=function(t){var e=this;null!=t.authResponse?(CP.FacebookService.getInstance.getInfo(function(e){CP.FacebookService.getInstance.getProfilePic(function(i){var n=new CP.FacebookServiceTracking;n.param.id=t.authResponse.userID,n.param.json_me=JSON.stringify(e),n.param.json_picture=JSON.stringify(i);var o=n.create();o.done(function(t){})})}),null!=this.$el&&(this.$el.remove(),this.renderLayoutAuth(function(){e.parent.$el.prepend(e.$el)}))):(this.$el.remove(),this.renderLayoutNotAuth(function(){e.parent.$el.prepend(e.$el)}))}}(jQuery,window,document),!function(t,e,i,n){CP.FeedbackService=function(){return this.setParam=function(t){return this.param=t,this},this},CP.FeedbackService.prototype.param=null,CP.FeedbackService.prototype.sendFeedback=function(){var e=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.sendFeedback,type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(this.param)});return e}}(jQuery,window,document),!function(t,e,i,n){CP.FreeDrawModule=function(t){this.$el=null,this.$btnSwitchDrawMode=null,this.$elmetarial=null,this.$elButton=null,this.$inputLineWidth=null,this.$inputLineColor=null,this.$elHeading=null,this.$elBody=null,this.IS_ENABLE_DRAW_MODE=!1,this.viewPath="js/module/free.draw.module/view/template.html"},CP.FreeDrawModule.prototype.init=function(e){var i=this;t.get(this.viewPath,function(n){var o=t(n).html(),a=Handlebars.compile(o);i.$el=t(a()),i.initElement(),i.$elBody.hide(),i.bindEvent(),e.call(this)})},CP.FreeDrawModule.prototype.getElement=function(){return this.$el},CP.FreeDrawModule.prototype.initElement=function(){this.$btnSwitchDrawMode=this.$el.find(".draw-mode"),this.$elmetarial=this.$el.find(".metarial"),this.$elButton=this.$el.find("button"),this.$inputLineWidth=this.$el.find("#drawing-line-width"),this.$inputLineColor=this.$el.find("#drawing-color"),this.$elHeading=this.$el.find(".panel-heading"),this.$elBody=this.$el.find(".panel-body"),this.$elHeading.css({cursor:"pointer"})},CP.FreeDrawModule.prototype.bindEvent=function(){var e=this;this.$btnSwitchDrawMode.unbind("click").bind("click",function(i){i.stopPropagation(),e.IS_ENABLE_DRAW_MODE=!e.IS_ENABLE_DRAW_MODE,e.IS_ENABLE_DRAW_MODE?(t(this).find("i").removeClass().addClass("ion-toggle"),e.$elmetarial.hide()):(t(this).find("i").removeClass().addClass("ion-toggle-filled"),e.$elmetarial.show()),MYLIB.eventManager.fireEvent(e,MYLIB.eventNames.event_switch_drawmode,e.IS_ENABLE_DRAW_MODE)}),this.$elButton.click(function(i){var n=t(this).data("type");e.$elButton.removeClass("enableClass"),t(this).removeClass().addClass("enableClass"),MYLIB.eventManager.fireEvent(e,MYLIB.eventNames.event_free_draw,n)}),this.$inputLineWidth.bind("change",function(i){t(this).prev().html(t(this).val()+"px"),MYLIB.eventManager.fireEvent(e,MYLIB.eventNames.event_set_line_width_free_draw,t(this).val())}),this.$inputLineColor.bind("change",function(i){MYLIB.eventManager.fireEvent(e,MYLIB.eventNames.event_set_line_color_free_draw,t(this).val())}),this.$elHeading.click(function(t){e.$elBody.slideToggle("fast")})},CP.FreeDrawModule.prototype.show=function(){},CP.FreeDrawModule.prototype.hide=function(){},MYLIB.mixin(CP.FreeDrawModule,MYLIB.Event.ObserverMixin)}(jQuery,window,document),!function(t,e,i,n){CP.ControlController=function(){this.view=null,this.model=null,this.callbackScopeDashboard=null},CP.ControlController.prototype.init=function(t,e){this.callbackScopeDashboard=t,this.view=new CP.ControlView,this.model=new CP.ControlModelSerive,this.model.init(),this.view.init(this.model),this.view.render(this.renderView.bind(this,e))},CP.ControlController.prototype.renderView=function(t){t.call(this),this.bindEvent()},CP.ControlController.prototype.bindEvent=function(){this.view.bindEvent(this)},CP.ControlController.prototype.zoomHandle=function(t){var e=this.callbackScopeDashboard.rightModule.mainCanvas;e.zoomHandle.call(e,t.data)},CP.ControlController.prototype.rotateHandle=function(t){var e=this.callbackScopeDashboard.rightModule.mainCanvas;e.rotateHandle.call(e,t.data)},MYLIB.mixin(CP.ControlController,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.ControlModuleObject=function(){this.controller=null,this.callBackFunction=null},CP.ControlModuleObject.prototype.init=function(t,e){this.controller=new CP.ControlController,this.callBackFunction=t,this.controller.init(t,e)},MYLIB.mixin(CP.ControlModuleObject,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.ControlModelSerive=function(){this.path="js/module/module.control/view/template.html",this.data={title:"Chỉnh sửa",zoom:{title:"Zom","class":"zoom-control"},rotate:{title:"Rotate","class":"rotate-control"}}},CP.ControlModelSerive.prototype.init=function(){return!0},CP.ControlModelSerive.prototype.getElement=function(){},CP.ControlModelSerive.prototype.bindEvent=function(){},MYLIB.mixin(CP.ControlModelSerive,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.ControlView=function(){this.$el=null,this.$btnZoomIn=null,this.$btnZoomOut=null,this.rotateRight=null,this.rotateLeft=null,this.modelService=null,this.init=function(t){this.modelService=t}},CP.ControlView.prototype.render=function(e){var i=this;t.get(this.modelService.path,function(n){var o=t(n).html(),a=Handlebars.compile(o),s=a(i.modelService.data);i.$el=t(s),i.initElement.call(i),e.call(this)})},CP.ControlView.prototype.initElement=function(){this.$btnZoomIn=this.$el.find(".zoom-in"),this.$btnZoomOut=this.$el.find(".zoom-out"),this.rotateRight=this.$el.find(".rotate-right"),this.rotateLeft=this.$el.find(".rotate-left")},CP.ControlView.prototype.getElement=function(){return this.$el},CP.ControlView.prototype.bindEvent=function(t){this.$btnZoomIn.unbind("click touchstart").bind("click touchstart","ZOOMIN",t.zoomHandle.bind(t)),this.$btnZoomOut.unbind("click touchstart").bind("click touchstart","ZOOMOUT",t.zoomHandle.bind(t)),this.rotateRight.unbind("click touchstart").bind("click touchstart","ROTATERIGHT",t.rotateHandle.bind(t)),this.rotateLeft.unbind("click touchstart").bind("click touchstart","ROTATELEFT",t.rotateHandle.bind(t))},MYLIB.mixin(CP.ControlView,MYLIB.Event.ObserverMixin)}(jQuery,window,document),!function(t,e,i,n){CP.OpacityModule=function(){},CP.OpacityModule.prototype.html='<div class="panel panel-default"><div class="panel-heading"><i class="ion-ios-sunny-outline size-20"></i> <span>Độ mờ</span></div><div class="slide-font-size panel-body"><input id="{0}" type="range" min="0" max="100" value="{1}" step="1"  /><output id="{2}"></output></div></div>',CP.OpacityModule.prototype.$el=null,CP.OpacityModule.prototype.$rangeFontSzie=null,CP.OpacityModule.prototype.$outputRangeFontSzie=null,CP.OpacityModule.prototype.init=function(){this.html=this.html.format("opacity_input",100,"output_opacity"),this.$el=t(this.html),this.$rangeFontSzie=this.$el.find("#opacity_input"),this.$outputRangeFontSzie=this.$el.find("#output_opacity");var e=this.$rangeFontSzie.val();this.$outputRangeFontSzie.html(e),this.style(),this.bindEvent()},CP.OpacityModule.prototype.style=function(){this.$el.css({border:"1px solid rgb(217, 237, 204)",margin:"10px 0px 0px 0px"}),this.$outputRangeFontSzie.css({margin:"0 auto","text-align":"center"})},CP.OpacityModule.prototype.getElement=function(){return this.$el},CP.OpacityModule.prototype.bindEvent=function(){this.$rangeFontSzie.unbind("change").bind("change",this,this.changeOpacityHandle)},CP.OpacityModule.prototype.changeOpacityHandle=function(t){var e=t.data,i=e.$rangeFontSzie.val();e.$outputRangeFontSzie.html(i),MYLIB.eventManager.fireEvent(e,MYLIB.eventNames.event_opacity,i)},MYLIB.mixin(CP.OpacityModule,MYLIB.Event.ObserverMixin)}(jQuery,window,document),!function(t,e,i,n){CP.OrderController=function(t,e){this.checkOutStep1=null,this.checkOutStep2=null,this.checkOutStep3=null,this._page=[],this.isLogin=t.islogin,this.$el=null,this.$step1Wrapper=null,this.$step2Wrapper=null,this.$step3Wrapper=null,this.orderService=new CP.OrdersSerice,this.orderModule=e,this.orderThumb=null,this.viewPath="js/module/order.module.v1/view/template.html"},CP.OrderController.prototype.init=function(e){var i=this;this.checkOutStep1=new CP.OrderStep1Module(this),this.checkOutStep2=new CP.OrderStep2Module(this),this.checkOutStep3=new CP.OrderStep3Module(this),t.get(this.viewPath,function(n){var o=t(n).html(),a=Handlebars.compile(o);i.$el=t(a()),i.$step1Wrapper=i.$el.find(".step1"),i.$step2Wrapper=i.$el.find(".step2"),i.$step3Wrapper=i.$el.find(".step3"),i.checkOutStep1.init(i.renderStep1Success.bind(i)),e.call(this)})},CP.OrderController.prototype.renderStep1Success=function(){this.renderHinhThietKe(),this.$step1Wrapper.append(this.checkOutStep1.getElement()),this._page.push(this.checkOutStep1)},CP.OrderController.prototype.renderStep2Success=function(){this.checkOutStep2.$tennguoinhan.val(this.checkOutStep1.$inputName.val()),this.checkOutStep2.$phonenguoinhan.val(this.checkOutStep1.$inputPhone.val()),this.$step2Wrapper.append(this.checkOutStep2.getElement()),this._page.push(this.checkOutStep2),this.showCurrentPage()},CP.OrderController.prototype.renderStep3Success=function(){this.$step3Wrapper.append(this.checkOutStep3.getElement()),this._page.push(this.checkOutStep3),this.showCurrentPage(),this.orderModule.firstRender=!1},CP.OrderController.prototype.getElement=function(){return this.$el},CP.OrderController.prototype.showCurrentPage=function(){_.each(this._page,function(t,e,i){t.hide()}),this._page[this._page.length-1].show()},CP.OrderController.prototype.goBack=function(){_.each(this._page,function(t,e,i){t.hide()}),this._page.pop(),this._page[this._page.length-1].show()},CP.OrderController.prototype.nextToStep2=function(){this.checkOutStep2.init(this.renderStep2Success.bind(this))},CP.OrderController.prototype.backHandle=function(){this.goBack()},CP.OrderController.prototype.renderHinhThietKe=function(){this.fireEvent("RENDER_HINH_THIET_KE",!0)},CP.OrderController.prototype.submitOrderAndNextToStep3=function(){this.checkOutStep3.init(this.renderStep3Success.bind(this))},CP.OrderController.prototype.orderNow=function(){var e=this.checkOutStep1.getValue(),i=this.checkOutStep2.getValue(),n=t.extend(e,i);n.id_product=this.orderModule.dashboardCallback.rightModule.mainCanvas.getIdProduct(),n.hasBack=this.orderModule.dashboardCallback.rightModule.mainCanvas.hasBack,n.hasLayerCircle=this.orderModule.dashboardCallback.rightModule.mainCanvas.hasLayerCircle,n.is_layerCircle=this.orderModule.dashboardCallback.rightModule.mainCanvas.is_layerCircle,n.thumb="",n.is_sharing&&(n.user_json=JSON.stringify(this.orderModule.dashboardCallback.rightModule.mainCanvas.getItemFromCanvas())),this.orderService.param.data=n;var o=this.orderService.create(),a=this;o.done(function(t){a.orderThumb=t.thumb,a.checkOutStep3.updateStatus(t.status)})},CP.OrderController.prototype.shareFacebook=function(){var t=i.URL,e=new CP.FacebookService,n=this;e.checkLogin(function(){e.shareAMessage(t,MYLIB.IMAGEHOST+n.orderThumb)},function(){e.loginFacebook(function(){e.shareAMessage(t,MYLIB.IMAGEHOST+n.orderThumb)})},function(){e.loginFacebook(function(){e.shareAMessage(t,MYLIB.IMAGEHOST+n.orderThumb)})})},MYLIB.mixin(CP.OrderController,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.OrderModule=function(t){this.isLogin=!1,this.$content=null,this.orderController=null,this.dashboardCallback=t},MYLIB.extend(CP.OrderModule,CP.PopupModule),CP.OrderModule.prototype.firstRender=!1,CP.OrderModule.prototype.init=function(){this.titlePopup='<i class="fa fa-credit-card fa"></i> THANH TOÁN VÀ GỬI ĐƠN HÀNG',this.parent.proto.init.call(this),this.$el.appendTo("body"),this.$content=this.$el.find(".modal-content"),this.firstRender=!0,this.isLogin=this.checkIsLogin(),this.orderController=new CP.OrderController({islogin:this.isLogin},this),this.orderController.init(this.renderViewOrderSuccess.bind(this)),this.$el.on("hide.bs.modal",this.hide.bind(this))},CP.OrderModule.prototype.renderViewOrderSuccess=function(){this.orderController.addListener("RENDER_HINH_THIET_KE",this,"renderImgHinhSanPhamHanlde"),this.$content.append(this.orderController.getElement())},CP.OrderModule.prototype.getElement=function(){return this.$el},CP.OrderModule.prototype.checkIsRender=function(){return this.$el},CP.OrderModule.prototype.checkIsLogin=function(){return!1},CP.OrderModule.prototype.show=function(){this.$el.modal("show"),this.$el.find(".modal-backdrop").height(t(e).height()+1200)},CP.OrderModule.prototype.checkRenderImageThietKe=function(){this.orderController.fireEvent("RENDER_HINH_THIET_KE",!0)},CP.OrderModule.prototype.renderImgHinhSanPhamHanlde=function(){var t=this.dashboardCallback.rightModule.mainCanvas.saveCanvasToImg();if(this.dashboardCallback.rightModule.mainCanvas.hasBack){var e=this.dashboardCallback.rightModule.mainCanvas.saveCanvasBackToImg(),i=this.orderController.checkOutStep1.getImgHinhThietkeMatsau();i.attr("src",e)}if(this.dashboardCallback.rightModule.mainCanvas.hasLayerCircle){var n=this.dashboardCallback.rightModule.mainCanvas.saveLayerCircleCanvasToImg(),o=this.orderController.checkOutStep1.$imgSanpham_layerBack;o.attr("src",n)}var a=this.orderController.checkOutStep1.getImgHinhThietke();a.attr("src",t)},CP.OrderModule.prototype.getSVG=function(){var t=this.dashboardCallback.rightModule.mainCanvas.saveCanvasToSVG();return t},CP.OrderModule.prototype.destroy=function(){this.$el.remove()},CP.OrderModule.prototype.hide=function(){this.destroy(),this.orderController.checkOutStep3.isFinalStep&&(this.$el.modal("hide"),t(e).unbind("beforeunload"),location.reload())},MYLIB.mixin(CP.OrderModule,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.OrderStep1Module=function(t){this.$el=null,this.$btnNext=null,this.$imgSanpham=null,this.$imgSanpham_back=null,this.$imgSanpham_layerBack=null,this.$inputName=null,this.$inputEmail=null,this.$inputPhone=null,this.$inputNote=null,this.$inputSoluong=null,this.viewPath="js/module/order.module.v1/view/step1.html",this.callbackOrderModule=t},CP.OrderStep1Module.prototype.init=function(e){var i=this;t.get(this.viewPath,function(n){var o=t(n).html(),a=Handlebars.compile(o);

i.$el=t(a()),i.$btnNext=i.$el.find(".step1-next"),i.$imgSanpham=i.$el.find(".hinh-anh-thiet-ke"),i.$imgSanpham_back=i.$el.find(".hinh-anh-thiet-ke-mat-sau"),i.$imgSanpham_layerBack=i.$el.find(".hinh-anh-thiet-ke-layer-circle"),i.$inputName=i.$el.find(".name"),i.$inputEmail=i.$el.find(".email"),i.$inputPhone=i.$el.find(".phone"),i.$inputNote=i.$el.find(".ghi-chu"),i.$inputSoluong=i.$el.find(".soluong"),i.bindEvent(),e.call(this)})},CP.OrderStep1Module.prototype.getElement=function(){return this.$el},CP.OrderStep1Module.prototype.getImgHinhThietke=function(){return this.$imgSanpham},CP.OrderStep1Module.prototype.getImgHinhThietkeMatsau=function(){return this.$imgSanpham_back},CP.OrderStep1Module.prototype.bindEvent=function(){this.$btnNext.bind("click",this.nextStep2Handle.bind(this))},CP.OrderStep1Module.prototype.show=function(){this.$el.addClass("animated fadeInLeft"),this.$el.removeClass("hidden")},CP.OrderStep1Module.prototype.hide=function(){this.$el.addClass("hidden"),this.$el.removeClass("animated fadeInLeft")},CP.OrderStep1Module.prototype.nextStep2Handle=function(){this.checkValidate()&&this.callbackOrderModule.nextToStep2.call(this.callbackOrderModule)},CP.OrderStep1Module.prototype.checkValidate=function(){var e=this.$inputEmail.val(),i=this.$inputPhone.val(),n=this.$inputName.val(),o=this.$inputSoluong.val();return""==t.trim(n)?(this.$inputName.toggleClass("animated swing"),alert("Xin quý khách vui lòng nhập tên họ!"),!1):CP.Validate.checkEmail(e)?CP.Validate.checkPhone(i,8,11)?CP.Validate.checkNumber(o,0,20)?!0:(this.$inputSoluong.toggleClass("animated swing"),alert("Xin lỗi, chúng tôi chỉ cung cấp được số lượng từ 1-10 sản phẩm"),!1):(this.$inputPhone.toggleClass("animated swing"),alert("Số điện thoại phải từ 8 -> 11 số.. Xin quý khách thông cảm"),!1):(this.$inputEmail.toggleClass("animated swing"),!1)},CP.OrderStep1Module.prototype.getValue=function(){if(this.callbackOrderModule.orderModule.dashboardCallback.rightModule.mainCanvas.is_layerCircle)var t={tenkhachhang:this.$inputName.val(),email:this.$inputEmail.val(),phone:this.$inputPhone.val(),orderNote:this.$inputNote.val(),hinhminhhoa:this.$imgSanpham.attr("src"),hinhminhhoa_back:this.$imgSanpham_back.attr("src"),hinhdein:this.callbackOrderModule.orderModule.dashboardCallback.rightModule.mainCanvas.getImageFrontToPrint(),hinhdein_back:this.callbackOrderModule.orderModule.dashboardCallback.rightModule.mainCanvas.getImageBackToPrint(),hinhdein_layerBack:this.callbackOrderModule.orderModule.dashboardCallback.rightModule.mainCanvas.getImgLayerCircleToPrint(),hinhminhhoa_layerBack:this.$imgSanpham_layerBack.attr("src"),soluong:this.$inputSoluong.val()};else var t={tenkhachhang:this.$inputName.val(),email:this.$inputEmail.val(),phone:this.$inputPhone.val(),orderNote:this.$inputNote.val(),hinhminhhoa:this.$imgSanpham.attr("src"),hinhminhhoa_back:this.$imgSanpham_back.attr("src"),hinhdein:this.callbackOrderModule.orderModule.dashboardCallback.rightModule.mainCanvas.getImageFrontToPrint(),hinhdein_back:this.callbackOrderModule.orderModule.dashboardCallback.rightModule.mainCanvas.getImageBackToPrint(),hinhdein_layerBack:"",hinhminhhoa_layerBack:"",soluong:this.$inputSoluong.val()};return t},MYLIB.mixin(CP.OrderStep1Module,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.OrderStep2Module=function(t){this.$el=null,this.$btnBack=null,this.$btnSubmit=null,this.$howtopay=null,this.$tennguoinhan=null,this.$phonenguoinhan=null,this.$diachigiaohang=null,this.$sharing=null,this.$banking_z=null,this.$banking_account=null,this.$banking_name=null,this.$banking_nd=null,this.viewPath="js/module/order.module.v1/view/step2.html",this.callbackOrderModule=t},CP.OrderStep2Module.prototype.init=function(e){var i=this;t.get(this.viewPath,function(o){var a=t(o).html(),s=Handlebars.compile(a);i.$el=t(s()),i.$btnBack=i.$el.find(".back"),i.$btnSubmit=i.$el.find(".check-out-submit"),i.$howtopay=i.$el.find(".how-to-pay"),i.$tennguoinhan=i.$el.find(".ten-nguoi-nhan"),i.$phonenguoinhan=i.$el.find(".phone_nguoi_nhan"),i.$diachigiaohang=i.$el.find(".dia-chi-giao-hang"),i.$sharing=i.$el.find(".share-member"),i.$banking_z=i.$el.find(".chuyenkhoan-user"),i.$banking_account=i.$banking_z.find(".bankingaccount"),i.$banking_name=i.$banking_z.find(".bankingname"),i.$banking_nd=i.$banking_z.find(".banking_noidung");var r=MYLIB.getParamURL("isAdmin");r!=n&&r||i.$sharing.parent().parent().remove(),i.bindEvent(),e.call(this)})},CP.OrderStep2Module.prototype.show=function(){this.$el.addClass("animated fadeInLeft"),this.$el.removeClass("hidden")},CP.OrderStep2Module.prototype.hide=function(){this.$el.addClass("hidden"),this.$el.removeClass("animated fadeInLeft")},CP.OrderStep2Module.prototype.getElement=function(){return this.$el},CP.OrderStep2Module.prototype.bindEvent=function(){this.$btnBack.bind("click",this.backHandle.bind(this)),this.$btnSubmit.bind("click",this.submitOrderAndNextToStep3.bind(this)),this.$howtopay.change(this.changeHowToPay.bind(this))},CP.OrderStep2Module.prototype.backHandle=function(){this.callbackOrderModule.backHandle.call(this.callbackOrderModule)},CP.OrderStep2Module.prototype.submitOrderAndNextToStep3=function(){this.checkValidate()&&this.callbackOrderModule.submitOrderAndNextToStep3.call(this.callbackOrderModule)},CP.OrderStep2Module.prototype.checkValidate=function(){var e=(this.$diachigiaohang.val(),this.$phonenguoinhan.val()),i=this.$tennguoinhan.val();return""==t.trim(i)?(this.$tennguoinhan.toggleClass("animated swing"),alert("Xin quý khách vui lòng nhập tên người nhận!"),!1):CP.Validate.checkPhone(e,8,11)?!0:(this.$phonenguoinhan.toggleClass("animated swing"),alert("Số điện thoại phải từ 8 -> 11 số.. Xin quý khách thông cảm"),!1)},CP.OrderStep2Module.prototype.getValue=function(){var t={phuongthucthanhtoan:this.$howtopay.val(),tennguoinhan:this.$tennguoinhan.val(),phone_nguoinhan:this.$phonenguoinhan.val(),diachinguoinhan:this.$diachigiaohang.val(),is_sharing:this.$sharing.is(":checked")?!0:!1,bank_account:this.$banking_account.val(),bank_name:this.$banking_name.val(),noidung_bank:this.$banking_nd.val(),list_asset_imgs:"",list_facebook_imgs:""};return t},CP.OrderStep2Module.prototype.changeHowToPay=function(){var t=this.$howtopay.val();"Chuyển khoản ngân hàng"===t?(this.$banking_z.removeClass("hidden"),this.$banking_nd.val(this.$tennguoinhan.val())):this.$banking_z.addClass("hidden")},MYLIB.mixin(CP.OrderStep2Module,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.OrderStep3Module=function(t){this.$el=null,this.viewPath="js/module/order.module.v1/view/step3.html",this.$elStatus=null,this.$elStatusMessage=null,this.$elloading=null,this.$shareFacebook=null,this.isFinalStep=!1,this.callbackOrderController=t},CP.OrderStep3Module.prototype.init=function(e){var i=this;t.get(this.viewPath,function(n){var o=t(n).html(),a=Handlebars.compile(o);i.$el=t(a()),i.$elStatus=i.$el.find(".status-order"),i.$elStatusMessage=i.$el.find(".status-order-msg"),i.$elloading=i.$el.find(".loading"),i.$shareFacebook=i.$el.find(".share-fb"),i.orderNow.call(i),i.bindEvent(),i.isFinalStep=!0,e.call(this)})},CP.OrderStep3Module.prototype.show=function(){this.$el.addClass("animated fadeInLeft"),this.$el.removeClass("hidden")},CP.OrderStep3Module.prototype.hide=function(){this.$el.addClass("hidden"),this.$el.removeClass("animated fadeInLeft")},CP.OrderStep3Module.prototype.getElement=function(){return this.$el},CP.OrderStep3Module.prototype.bindEvent=function(){var t=this;this.$shareFacebook.bind("click",function(e){t.callbackOrderController.shareFacebook.call(t.callbackOrderController)})},CP.OrderStep3Module.prototype.backHandle=function(){},CP.OrderStep3Module.prototype.orderNow=function(){this.callbackOrderController.orderNow.call(this.callbackOrderController)},CP.OrderStep3Module.prototype.updateStatus=function(t){this.$elloading.hide(),"fail"==t?(this.$elStatus.text("Có lỗi xãy ra trong quá trình xử lý đơn hàng..."),this.$elStatusMessage.text("Có lỗi xãy ra trong quá trình xử lý đơn hàng, vui lòng tắt popup và thử lại")):"success"==t&&(this.$elStatus.text("Đặt hàng thành công"),this.$elStatusMessage.text("Cảm ơn bạn đã lựa chọn chúng tôi, đơn hàng của bạn đã được xử lý, chúng tôi sẽ liên hệ với bạn trong thời gian ngắn nhất để giao hàng!"))},MYLIB.mixin(CP.OrderStep3Module,MYLIB.Event.ObserverMixin)}(jQuery,window,document),!function(t,e,i,n){CP.OrdersSerice=function(){},CP.OrdersSerice.prototype.param={tenkhachhang:"",email:"",phone:"",orderNote:"",tennguoinhan:"",diachinguoinhan:"",phone_nguoinhan:"",bank_account:"",bank_name:"",noidung_bank:"",hinhdein:"",hinhminhhoa:"",isCase:1,isSkin:0,id_product:0,id_order:0,hang_dat_lai:0,is_sharing:0,list_asset_imgs:"",list_facebook_imgs:"",phuongthucthanhtoan:"",hasBack:0,hinhdein_back:"",hinhminhhoa_back:"",thumb:"",soluong:1},CP.OrdersSerice.prototype.create=function(){var e=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.createOrder,type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(this.param.data)});return e}}(jQuery,window,document),!function(t,e,i,n){CP.PopupModule=function(){this.html='<div class="modal" tabindex="-1" role="dialog" aria-hidden="true"><div class="modal-dialog modal-lg" style="width:1000px!important"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h2 class="modal-title">{0}</h2></div></div></div></div>',this.$el=null,this.$elContent=null,this.titlePopup="Modal title"},CP.PopupModule.prototype.init=function(){this.html=this.html.format(this.titlePopup),this.$el=t(this.html),this.$elContent=this.$el.find(".modal-content"),this.$elContent.css({"min-height":"300px"})},CP.PopupModule.prototype.show=function(){this.$el.modal("show"),this.$el.find(".modal-backdrop").height(t(e).height()+700)},CP.PopupModule.prototype.hide=function(){this.$el.modal("hide")}}(jQuery,window,document),!function(t,e,i,n){CP.PopupAssetCategoryItem=function(){this.cateItem=null,this.$el="",this.html='<div class="popup-left-item"></div>',this.activeClass="active-left-popup"},CP.PopupAssetCategoryItem.prototype.init=function(e){this.cateItem=e,this.$el=t(this.html),this.renderAblumItem()},CP.PopupAssetCategoryItem.prototype.renderAblumItem=function(){var t="<span>{0}</span>";t=t.format(this.cateItem.asset_name),this.$el.append(t),this.bindEvent()},CP.PopupAssetCategoryItem.prototype.bindEvent=function(){this.$el.unbind("click touchstart").bind("click touchstart",this.openListImageFromAssets.bind(this))},CP.PopupAssetCategoryItem.prototype.openListImageFromAssets=function(e){var i=t(e.target).parent();this.$el.siblings().removeClass(this.activeClass),i.addClass(this.activeClass),MYLIB.eventManager.fireEvent(this,MYLIB.eventNames.event_open_asset_photos,this.cateItem.asset_id)},MYLIB.mixin(CP.PopupAssetCategoryItem,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.PopupAssetCategories=function(){this.dataCates=null,this.$el="",this.html='<div class="popup-left-wrapper"><h4>Vui lòng chọn thư viện</h4></div>',this.$btnNext=null,this.service=new CP.AssetsSerice},CP.PopupAssetCategories.prototype.init=function(e){var i=CP.SingletonUser.getInstance();i.getFacebook(),this.$el=t(this.html),MYLIB.LOADING();var n=this,o=this.service.getAssetsCates();o.done(function(t){n.successGetCates.call(n,t),e.call(n),MYLIB.REMOVE_LOADING()})},CP.PopupAssetCategories.prototype.successGetCates=function(t){MYLIB.REMOVE_LOADING(),this.dataCates=t,this.render(this.dataCates)},CP.PopupAssetCategories.prototype.render=function(t){var e=this;_.each(t.assets,function(t,i,n){var o=new CP.PopupAssetCategoryItem;o.init(t),e.$el.append(o.$el)})},CP.PopupAssetCategories.prototype.getElement=function(){return this.$el}}(jQuery,window,document),function(t,e,i,n){CP.PopupAssetsModule=function(){this.popupAssetsCates=null,this.popupAssetsAssetArea=null},MYLIB.extend(CP.PopupAssetsModule,CP.PopupModule),CP.PopupAssetsModule.prototype.firstRender=!1,CP.PopupAssetsModule.prototype.init=function(){this.titlePopup="Chọn hình từ thư viện",this.parent.proto.init.call(this),this.$el.appendTo("body"),this.popupAssetsAssetArea=new CP.PopupAssetsModulePhotosArea,this.popupAssetsAssetArea.init(),this.popupAssetsCates=new CP.PopupAssetCategories,this.popupAssetsCates.init(this.render.bind(this)),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_open_asset_photos,"openPhotosHandle"),MYLIB.eventManager.subscribe(this,"CLOSE_POPUP_ASSET","closeHandle"),this.firstRender=!0},CP.PopupAssetsModule.prototype.getElement=function(){return this.$el},CP.PopupAssetsModule.prototype.render=function(){this.$elContent.append(this.popupAssetsCates.getElement()),this.$elContent.append(this.popupAssetsAssetArea.getElement())},CP.PopupAssetsModule.prototype.openPhotosHandle=function(t){var e=t.data;this.popupAssetsAssetArea.show(e)},CP.PopupAssetsModule.prototype.closeHandle=function(t){this.$el.modal("hide")},MYLIB.mixin(CP.PopupAssetsModule,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.PopupAssetsModulePhotosArea=function(){this.$el=null,this.html='<div class="photos-albums"></div>',this.dictPhoto={},this.service=new CP.AssetsSerice},CP.PopupAssetsModulePhotosArea.prototype.init=function(){this.$el=t(this.html)},CP.PopupAssetsModulePhotosArea.prototype.getElement=function(){return this.$el},CP.PopupAssetsModulePhotosArea.prototype.show=function(t){this.hideAll(),this.dictPhoto[t]?this.dictPhoto[t].show():this.renderPhotosPage(t)},CP.PopupAssetsModulePhotosArea.prototype.renderPhotosPage=function(t){this.dictPhoto[t]=new CP.PopupAssetsModulePhotos;var e=this;MYLIB.LOADING();var i=this.service.getAssetsMediaByCates(t);i.done(function(i){e.dictPhoto[t].init(i,t),e.$el.append(e.dictPhoto[t].getElement()),e.dictPhoto[t].show(),e.dictPhoto[t].bindEvent(),MYLIB.REMOVE_LOADING()}),i.error(function(){MYLIB.REMOVE_LOADING(),alert("Something wrong, vui lòng thử lại")})},CP.PopupAssetsModulePhotosArea.prototype.hideAll=function(){_.each(this.dictPhoto,function(t){t.hide()})}}(jQuery,window,document),function(t,e,i,n){CP.PopupAssetsModulePhotosItem=function(){this.$el=null,this.html='<div class="list-photos-album-item-wrapper"></div>',this.data=null,this.typePhoto=null},CP.PopupAssetsModulePhotosItem.prototype.init=function(e){this.data=e,this.$el=t(this.html);var i='<img src="{0}" class="thumbnail"/>';i=i.format(MYLIB.IMAGEHOST+"/"+e.thumb),this.$el.append(i),this.bindEvent()},CP.PopupAssetsModulePhotosItem.prototype.show=function(){this.$el.removeClass("no-show")},CP.PopupAssetsModulePhotosItem.prototype.hide=function(){this.$el.addClass("no-show")},CP.PopupAssetsModulePhotosItem.prototype.getElement=function(){return this.$el},CP.PopupAssetsModulePhotosItem.prototype.bindEvent=function(){var t=this;this.$el.unbind("click touch").bind("click touch",function(e){MYLIB.LOADING();var i=MYLIB.IMAGEHOST+t.data.photo,n=t.data.id,o=t.data.thumb;MYLIB.convertImgToBase64(i,function(e){MYLIB.REMOVE_LOADING(),MYLIB.eventManager.fireEvent(t,MYLIB.eventNames.event_upload_from_asset,{src:e,id:n,thumb:o}),MYLIB.eventManager.fireEvent(t,"CLOSE_POPUP_ASSET",!0)})})}}(jQuery,window,document),function(t,e,i,n){CP.PopupAssetsModulePhotos=function(){this.$el=null,this.html='<div  class="list-photos-album"></div>',this.dataPhoto=null,this.albumId=null},CP.PopupAssetsModulePhotos.prototype.init=function(e,i){this.dataPhoto=e,this.albumId=i,this.$el=t(this.html),this.renderLayout(e)},CP.PopupAssetsModulePhotos.prototype.renderLayout=function(t){var e=this;t.reverse(),_.each(t,function(t,i,n){var o=new CP.PopupAssetsModulePhotosItem;o.init(t),e.$el.append(o.getElement())})},CP.PopupAssetsModulePhotos.prototype.show=function(){this.$el.removeClass("no-show")},CP.PopupAssetsModulePhotos.prototype.hide=function(){this.$el.addClass("no-show")},CP.PopupAssetsModulePhotos.prototype.getElement=function(){return this.$el},CP.PopupAssetsModulePhotos.prototype.bindEvent=function(){}}(jQuery,window,document),!function(t,e,i,n){CP.PriceModule=function(){this.price=null,this.percent_sale=0,this.$el=null,this.html=""},CP.PriceModule.prototype.init=function(e,i){this.price=e;var n='<div data-step="4" data-intro="Gía tham khảo của sản phẩm"><div class="title-style-1">Giá tham khảo</div><div class="price_module" style="color:#d9534f;font-size:25px"><b>{0} {1}</b></div></div>';this.html=n.format(this.price,i),this.$el=t(this.html)},CP.PriceModule.prototype.getElement=function(){return this.$el},CP.PriceModule.prototype.display=function(t,e){var i=parseFloat(e).toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,");this.init(i,"đ"),t.append(this.$el)}}(jQuery,window,document),!function(t,e,i,n){CP.productSerice=function(){},CP.productSerice.prototype.param=null,CP.productSerice.prototype.getProducts=function(e){var i=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.getAllProductAllHome+"/"+e,type:"GET",contentType:"application/json",dataType:"json"});return i},CP.productSerice.prototype.getSpecificProducts=function(e){var i=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.getSpecificProducts,type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(e)});return i},CP.productSerice.prototype.getCatesByID=function(e){var i=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.getDanhMuc+"/"+e,type:"GET",contentType:"application/json",dataType:"json"});return i},CP.productSerice.prototype.getProductByCate=function(e,i){var n=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.getProductByCate+"?cate="+e+"&"+i+"="+i,type:"GET",contentType:"application/json",dataType:"json"});return n},CP.productSerice.prototype.getCate=function(e){var i=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.getCate+"/"+e,type:"GET",contentType:"application/json",dataType:"json"});return i}}(jQuery,window,document),!function(t,e,i,n){CP.ProductTabModule=function(){this.$el=null,this.viewPath=MYLIB.mainUrl+"js/module/product.tab.module/view/tmp.html",this.$elProductInfo=null,this.$elProductImgs=null},CP.ProductTabModule.prototype.init=function(e){var i=this;null!=this.$el&&this.$el.remove(),t.get(this.viewPath,function(o){var a=t(o).html(),s=Handlebars.compile(a);i.$el=t(s()),i.$elProductInfo=i.$el.find("#productInfo"),i.$elProductImgs=i.$el.find("#productImgs"),e!=n&&"function"==typeof e&&e.call(i)})},CP.ProductTabModule.prototype.render=function(e){this.$elProductInfo.html(""!=t.trim(e.product_content)?e.product_content:"Chưa có thông tin sản phẩm");var i=t.parseJSON(e.product_imgs);if(i.data.length>0){var n=t("<ul></ul>");_.each(i.data,function(t,e,i){n.append('<li><a><img src="'+MYLIB.IMAGEHOST+"/"+t.thumb+'" /></a></li>')}),n.find("li").css({display:"inline-block","margin-right":"15px",cursor:"pointer"}),this.$elProductImgs.append(n)}else this.$elProductImgs.html("Chưa có hình ảnh thêm nào")}}(jQuery,window,document),!function(t,e,i,n){CP.SaveCanvas=function(){},CP.SaveCanvas.prototype.$el=null,CP.SaveCanvas.prototype.html="",CP.SaveCanvas.prototype.$btnSave=null,CP.SaveCanvas.prototype.$btnDelete=null,CP.SaveCanvas.prototype.$btnUp=null,CP.SaveCanvas.prototype.$btnDown=null,CP.SaveCanvas.prototype.init=function(){this.html='<div class="save-canvas-module panel panel-default"><div class="panel-body"><span class="tool-delete btn btn-danger  btn-tron"><i class="fa fa-trash"></i></span><span class="tool-duplicate btn btn-default  btn-tron">Copy</span><span class="tool-up-to-front btn btn-default  btn-tron"><i class=" fa fa-angle-double-up"></i></span><span class="tool-down-to-back btn btn-default  btn-tron"><i class=" fa fa-angle-double-down"></i></span></div></div>',this.$el=t(this.html),this.$btnSave=this.$el.find(".save-canvas"),this.$btnDelete=this.$el.find(".tool-delete"),this.$btnCopy=this.$el.find(".tool-duplicate"),this.$btnUp=this.$el.find(".tool-up-to-front"),this.$btnDown=this.$el.find(".tool-down-to-back"),this.$el.find("span").css({margin:"0 0 0px 0px"}),this.bindEvents()},CP.SaveCanvas.prototype.getElement=function(){return this.$el},CP.SaveCanvas.prototype.bindEvents=function(){var t=this;this.$btnSave.unbind("click touchstart").bind("click touchstart",this,function(e){MYLIB.eventManager.fireEvent(t,MYLIB.eventNames.saveCanvas,!0)}),this.$btnDelete.unbind("click touchstart").bind("click",this,this.deleteItemHandle),this.$btnCopy.unbind("click touchstart").bind("click",this,this.duplicate),this.$btnUp.unbind("click touchstart").bind("click",function(){MYLIB.eventManager.fireEvent(this,"UPTOFRONT",!0)}),this.$btnDown.unbind("click touchstart").bind("click",function(){MYLIB.eventManager.fireEvent(this,"DOWNTOBACK",!0)})},CP.SaveCanvas.prototype.deleteItemHandle=function(){MYLIB.eventManager.fireEvent(this,MYLIB.eventNames.event_delete_item,"true")},CP.SaveCanvas.prototype.duplicate=function(){MYLIB.eventManager.fireEvent(this,MYLIB.eventNames.event_duplicate_item,"true")},MYLIB.mixin(CP.SaveCanvas,MYLIB.Event.ObserverMixin)}(jQuery,window,document),!function(t,e,i,n){CP.AssetsSerice=function(){},CP.AssetsSerice.prototype.param=null,CP.AssetsSerice.prototype.getAssetsCates=function(){var e=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.getAssetCates,type:"GET",dataType:"json"});return e},CP.AssetsSerice.prototype.getAssetsMediaByCates=function(e){var i=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.getAssetMediaByCate+"/"+e,type:"GET",dataType:"json"});return i}}(jQuery,window,document),function(t,e,i,n){CP.FacebookServiceTracking=function(){},CP.FacebookServiceTracking.prototype.param={id:"",json_me:"",json_picture:""},CP.FacebookServiceTracking.prototype.create=function(){var e=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.fakeServiceTest1,type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(this.param)});return e},CP.FacebookServiceTracking.prototype.getUserProfile=function(e){var i=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.getUserProfile+"/"+e,type:"GET",contentType:"application/json",dataType:"json"});return i},CP.FacebookServiceTracking.prototype.updateProfileUser=function(e){var i=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.updateProfileUser,type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(e)});return i}}(jQuery,window,document),function(t,e,i,n){CP.FeedbackService=function(){return this.setParam=function(t){return this.param=t,this},this},CP.FeedbackService.prototype.param=null,CP.FeedbackService.prototype.sendFeedback=function(){var e=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.sendFeedback,type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(this.param)});return e}}(jQuery,window,document),function(t,e,i,n){CP.OrdersSerice=function(){},CP.OrdersSerice.prototype.param={tenkhachhang:"",email:"",phone:"",orderNote:"",tennguoinhan:"",diachinguoinhan:"",phone_nguoinhan:"",bank_account:"",bank_name:"",noidung_bank:"",hinhdein:"",hinhminhhoa:"",isCase:1,isSkin:0,id_product:0,id_order:0,hang_dat_lai:0,is_sharing:0,list_asset_imgs:"",list_facebook_imgs:"",phuongthucthanhtoan:"",hasBack:0,hinhdein_back:"",hinhminhhoa_back:"",hasLayerCircle:0,hinhdein_layerBack:"",hinhminhhoa_layerBack:"",thumb:"",soluong:1,is_layerCircle:!1},CP.OrdersSerice.prototype.create=function(){var e=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.createOrder,type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(this.param.data)});return e},CP.OrdersSerice.prototype.getTemplateOrder=function(){var e=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.getSpecificThietkemau,type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(this.param.data)});return e}}(jQuery,window,document),function(t,e,i,n){CP.productSerice=function(){},CP.productSerice.prototype.param=null,CP.productSerice.prototype.getProducts=function(e){var i=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.getAllProductAllHome+"/"+e,type:"GET",contentType:"application/json",dataType:"json"});return i},CP.productSerice.prototype.getSpecificProducts=function(e){var i=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.getSpecificProducts,type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(e)});return i},CP.productSerice.prototype.getCatesByID=function(e){var i=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.getDanhMuc+"/"+e,type:"GET",contentType:"application/json",dataType:"json"});return i},CP.productSerice.prototype.getProductByCate=function(e,i){var n=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.getProductByCate+"?cate="+e+"&"+i+"="+i,type:"GET",contentType:"application/json",dataType:"json"});return n},CP.productSerice.prototype.getCate=function(e){var i=t.ajax({url:MYLIB.HOST+MYLIB.SERVICENAME.getCate+"/"+e,type:"GET",contentType:"application/json",dataType:"json"});return i}}(jQuery,window,document),function(t,e,i,n){CP.User=function(){this.name="",this.avatar="",this.email="",this.facebookObj={status:null,album:null,key:"facebook_obj"},this.id=null,this.key="cyo_user"},CP.User.prototype.init=function(){},CP.User.prototype.loginFacebook=function(t){var e=this,i=new CP.FacebookService;i.loginFacebook(function(){e.checkFacebookObj(),t()})},CP.User.prototype.getFacebook=function(){return localStorage[this.facebookObj.key]!=n?jQuery.parseJSON(localStorage[this.facebookObj.key]):null},CP.User.prototype.checkFacebookObj=function(t,e,i){var n=new CP.FacebookService,o=this;n.checkLogin(function(e){o.setFacebook(e),"function"==typeof t&&t(e)},function(i){"function"==typeof t&&e(i)},function(e){"function"==typeof t&&i(e)})},CP.User.prototype.setFacebook=function(t){localStorage[this.facebookObj.key]=JSON.stringify(t),this.facebookObj.status=localStorage[this.facebookObj.key]},CP.User.prototype.checkLogin=function(){},CP.User.prototype.getName=function(){return this.name},CP.User.prototype.setName=function(t){this.name=t},CP.SingletonUser=function(){function t(t,e){var i=new CP.User;return i.init(),i}var e;return{getInstance:function(){return e||(e=t()),e}}}()}(jQuery,window,document),function(t,e,i,n){CP.Validate=function(){var t=/^[0-9]+$/,e=/^\-?[0-9]+$/,i=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,n=/^[a-z]+$/i,o=/^[a-zA-ZÀÁÂÃÈÉÊÌÍÒÓÔÕÙÚĂĐĨŨƠàáâãèéêìíòóôõùúăđĩũơƯĂẠẢẤẦẨẪẬẮẰẲẴẶẸẺẼỀỀỂưăạảấầẩẫậắằẳẵặẹẻẽềềểỄỆỈỊỌỎỐỒỔỖỘỚỜỞỠỢỤỦỨỪễệỉịọỏốồổỗộớờởỡợụủứừỬỮỰỲỴÝỶỸửữựỳỵỷỹ ]+$/i,a=function(t){var e=i.exec(t);return e},s=function(e,i,n){if(e.length>i&&e.length<=n){var o=t.exec(e);return o}return!1},r=function(t,e){if(t.length>e){var i=n.exec(t);return i}return!1},l=function(t,e){if(t.length>e){var i=o.exec(t);return i}return!1},c=function(t,i,n){if(t>i&&n>t){var o=e.exec(t);return o}return!1};return{checkEmail:a,checkPhone:s,checkUsername:r,checkFullName:l,checkNumber:c}}()}(jQuery,window,document),!function(t,e,i,n){CP.ShapeController=function(){this.view=null,this.model=null,this.callbackScopeDashboard=null},CP.ShapeController.prototype.init=function(t,e){this.callbackScopeDashboard=t,this.view=new CP.ShapeView,this.model=new CP.ShaperModelSerive,this.model.init(),this.view.init(this.model),this.view.render(this.renderView.bind(this,e))},CP.ShapeController.prototype.renderView=function(t){t.call(this),this.bindEvent()},CP.ShapeController.prototype.bindEvent=function(){this.view.bindEvent(this)},CP.ShapeController.prototype.drawShape=function(t){var e=this.callbackScopeDashboard.rightModule.mainCanvas;e.drawShape.call(e,t.data)},MYLIB.mixin(CP.ShapeController,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.ShapeModule=function(){this.controller=null,this.callBackFunction=null},CP.ShapeModule.prototype.init=function(t,e){this.controller=new CP.ShapeController,this.callBackFunction=t,this.controller.init(t,e)},MYLIB.mixin(CP.ShapeModule,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.ShaperModelSerive=function(){this.path="js/module/shape.module/view/template.html",this.data={title:"Chọn hình shape",circle:{title:"Hình tròn","class":"circle-shape"},rect:{title:"Hình vuông","class":"rect-shape"}}},CP.ShaperModelSerive.prototype.init=function(){return!0},CP.ShaperModelSerive.prototype.getElement=function(){},CP.ShaperModelSerive.prototype.bindEvent=function(){},MYLIB.mixin(CP.ShaperModelSerive,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.ShapeView=function(){this.$el=null,this.$btnCircle=null,this.$btnRect=null,this.modelService=null,this.init=function(t){this.modelService=t}},CP.ShapeView.prototype.render=function(e){var i=this;t.get(this.modelService.path,function(n){var o=t(n).html(),a=Handlebars.compile(o),s=a(i.modelService.data);i.$el=t(s),i.initElement.call(i),e.call(this)})},CP.ShapeView.prototype.initElement=function(){var t=this;this.$btnCircle=this.$el.find("."+t.modelService.data.circle["class"]),this.$btnRect=this.$el.find("."+t.modelService.data.rect["class"])},CP.ShapeView.prototype.getElement=function(){return this.$el},CP.ShapeView.prototype.bindEvent=function(t){this.$btnCircle.unbind("click touchstart").bind("click touchstart","CIRCLE",t.drawShape.bind(t)),this.$btnRect.unbind("click touchstart").bind("click touchstart","RECT",t.drawShape.bind(t))},MYLIB.mixin(CP.ShapeView,MYLIB.Event.ObserverMixin)}(jQuery,window,document),!function(t,e,i,n){CP.SnapShotModule=function(t){this.viewPath="js/module/snapshot/view/template.html",this.callbackDashboard=t,this.$btnPhoto=null,this.$elResult=null},MYLIB.extend(CP.SnapShotModule,CP.PopupModule),CP.SnapShotModule.prototype.init=function(){this.titlePopup="Chụp ảnh nào",this.parent.proto.init.call(this),this.$el.find(".modal-dialog").removeClass("modal-lg"),this.$el.appendTo("body"),this.render()},CP.SnapShotModule.prototype.getElement=function(){return this.$el},CP.SnapShotModule.prototype.render=function(){var e=this;t.get(this.viewPath,function(i){var n=t(i).html(),o=Handlebars.compile(n),a=o();e.$elContent.append(t(a)),e.initElement.call(e),e.bindEvent()})},CP.SnapShotModule.prototype.initElement=function(){this.$btnPhoto=this.$elContent.find(".btn-take-photo"),this.$elResult=this.$elContent.find(".result")},CP.SnapShotModule.prototype.show=function(){Webcam.reset(),Webcam.set({width:420,height:340,image_format:"jpeg",jpeg_quality:90}),Webcam.attach("#webcam-popup"),this.$el.modal("show")},CP.SnapShotModule.prototype.bindEvent=function(){MYLIB.click(this.$btnPhoto,this.takeAShotToCanvas.bind(this))},CP.SnapShotModule.prototype.takeAShotToCanvas=function(){var t=this;Webcam.snap(function(e){t.$elResult.html("");var i='<img src=" '+e+' " style="width:100%"/>';t.$elResult.append(i),MYLIB.eventManager.fireEvent(t,MYLIB.eventNames.event_upload_from_computer,e)})},MYLIB.mixin(CP.PopupAssetsModule,MYLIB.Event.ObserverMixin)}(jQuery,window,document),!function(t,e,i,n){"use strick";CP.SocialController=function(){this.view=null,this.model=null,this.facebookService=null},CP.SocialController.prototype.init=function(){this.view=new CP.SocialView,this.view.init(),this.model=new CP.SocialModel,this.model.init(),this.facebookService=new CP.FacebookService,this.view.render([this.model.hrefFacebook,this.model.urlImgFacebook,this.model.hrefFacebook,this.model.hrefGplus,this.model.urlImgGplus]),this.bindEvent()},CP.SocialController.prototype.bindEvent=function(){this.view.bindEvent(this)},CP.SocialController.prototype.openFacebookHandle=function(t){return t.preventDefault(),t.data,!1},MYLIB.mixin(CP.SocialController,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.SocialModel=function(){this.hrefFacebook="facebook.com",this.urlImgFacebook="imgs/theme/facebook.png",this.hrefGplus="google.com",this.urlImgGplus="imgs/theme/gplus.png"},CP.SocialModel.prototype.init=function(){return!0},CP.SocialModel.prototype.getElement=function(){},CP.SocialModel.prototype.bindEvent=function(){},MYLIB.mixin(CP.SocialModel,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){"use strick";CP.SocialModule=function(){this.controller=null},CP.SocialModule.prototype.init=function(){this.controller=new CP.SocialController,this.controller.init()},MYLIB.mixin(CP.SocialModule,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){
CP.SocialView=function(){this.html="",this.$el=null,this.$fb=null,this.init=function(){this.html='<div class="socical-wrapper" style="bottom:20%"><ul><li  class="facebook"><a href="{0}"></a></li></ul></div>'}},CP.SocialView.prototype.render=function(e){if(!t.isArray(e))throw"Data render must be array";this.html=this.html.format(e[0]),this.$el=t(this.html),this.$fb=this.$el.find("li").eq(0),this.style()},CP.SocialView.prototype.style=function(){this.$el.css({right:0,top:"-60px",display:"inline-block",position:"absolute"}),this.$el.find("ul").css({listStyle:"none"}),this.$el.find("li").css({padding:"5px",display:"inline-block"})},CP.SocialView.prototype.getElement=function(){return this.$el},CP.SocialView.prototype.bindEvent=function(t){},MYLIB.mixin(CP.SocialView,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.PopupFacebookAblumsItem=function(){this.albumItem=null,this.$el="",this.html='<div class="albums-facebook-item popup-left-item"></div>',this.activeClass="active-left-popup"},CP.PopupFacebookAblumsItem.prototype.init=function(e){this.albumItem=e,this.$el=t(this.html),this.renderAblumItem()},CP.PopupFacebookAblumsItem.prototype.renderAblumItem=function(){var t="<span>{0}</span>";t=t.format(this.albumItem.name),this.$el.append(t),this.bindEvent()},CP.PopupFacebookAblumsItem.prototype.bindEvent=function(){this.$el.unbind("click touchstart").bind("click touchstart",this.openListImageFromAlbums.bind(this))},CP.PopupFacebookAblumsItem.prototype.openListImageFromAlbums=function(e){var i=t(e.target).parent();t(".albums-facebook-item").removeClass(this.activeClass),i.addClass(this.activeClass),MYLIB.eventManager.fireEvent(this,MYLIB.eventNames.event_open_photos,this.albumItem.id)},MYLIB.mixin(CP.PopupFacebookAblumsItem,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.PopupFacebookAblumsModule=function(){this.dataAlbums=null,this.$el="",this.html='<div class="albums-facebook popup-left-wrapper"><span class="next-albums" style="cursor:pointer">Load tiếp ablums<i class="fa fa-chevron-circle-down fa-2x"></i></span><h4>Vui lòng chọn Album</h4></div>',this.$btnNext=null,this.facebookService=new CP.FacebookService},CP.PopupFacebookAblumsModule.prototype.init=function(e){var i=CP.SingletonUser.getInstance();i.getFacebook(),this.$el=t(this.html),this.$btnNext=this.$el.find(".next-albums"),this.$btnNext.unbind("click touchstart").bind("click touchstart",this,this.nextAlbumsHandle),MYLIB.LOADING();var n=this;this.facebookService.getAlbums(10,"",function(t){n.successGetAlbums(t),e()})},CP.PopupFacebookAblumsModule.prototype.successGetAlbums=function(t){MYLIB.REMOVE_LOADING(),this.dataAlbums=t,this.renderAblums(this.dataAlbums.data)},CP.PopupFacebookAblumsModule.prototype.renderAblums=function(t){var e=this;_.each(t,function(t,i,n){var o=new CP.PopupFacebookAblumsItem;o.init(t),e.$el.append(o.$el)})},CP.PopupFacebookAblumsModule.prototype.getElement=function(){return this.$el},CP.PopupFacebookAblumsModule.prototype.nextAlbumsHandle=function(t){var e=t.data;MYLIB.LOADING(),e.facebookService.getAlbums(10,e.dataAlbums.paging.cursors.after,function(t){e.successGetAlbums(t)})}}(jQuery,window,document),function(t,e,i,n){CP.PopupFacebookModule=function(){this.facebookAlbumsModule=null,this.facebookPhotosModule=null},MYLIB.extend(CP.PopupFacebookModule,CP.PopupModule),CP.PopupFacebookModule.prototype.firstRender=!1,CP.PopupFacebookModule.prototype.init=function(){this.titlePopup="Chọn hình từ Facebook",this.parent.proto.init.call(this),this.$el.appendTo("body"),this.facebookAlbumsModule=new CP.PopupFacebookAblumsModule,this.facebookPhotosModule=new CP.PopupFacebookPhotosModule,this.facebookPhotosModule.init();var t=this;this.facebookAlbumsModule.init(function(){console.log("Load albums success"),t.$elContent.append(t.facebookAlbumsModule.getElement()),t.$elContent.append(t.facebookPhotosModule.getElement())}),MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_open_photos,"openPhotosHandle"),MYLIB.eventManager.subscribe(this,"CLOSE_POPUP_FACEBOOK","closeHandle"),this.firstRender=!0},CP.PopupFacebookModule.prototype.getElement=function(){return this.$el},CP.PopupFacebookModule.prototype.openPhotosHandle=function(t){var e=t.data;this.facebookPhotosModule.show(e)},CP.PopupFacebookModule.prototype.closeHandle=function(t){this.$el.modal("hide")},MYLIB.mixin(CP.PopupFacebookModule,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.PopupFacebookPhotosItemType=function(){this.$el=null,this.html='<div class="list-photos-album-item-popup-type"></div>',this.data=null,this.$btnClose=null},CP.PopupFacebookPhotosItemType.prototype.init=function(e){this.data=e,this.$el=t(this.html);var i=this;_.each(e,function(e,n,o){var a='<div style="cursor:pointer"><span data-type="{0}" class="" data-img="{1}">{2}</span></div>';a=a.format(e.width,e.source,e.width+" x "+e.height),a=t(a),a.unbind("click touchstart").bind("click touchstart",i.renderImageToCanvasHandle.bind(i)),i.$el.append(a)}),this.$btnClose=t('<div><i class="fa fa-caret-down fa-2x" style="color:#000"></i></div>'),i.$el.append(this.$btnClose),this.style(),this.$btnClose.unbind("click touchstart").bind("click touchstart",this,function(t){i.hide(),t.stopPropagation()})},CP.PopupFacebookPhotosItemType.prototype.show=function(){this.$el.removeClass("no-show")},CP.PopupFacebookPhotosItemType.prototype.hide=function(){this.$el.addClass("no-show")},CP.PopupFacebookPhotosItemType.prototype.getElement=function(){return this.$el},CP.PopupFacebookPhotosItemType.prototype.style=function(){this.$el.css({padding:"16px",position:"absolute",background:"rgb(201, 201, 201)","z-index":"99",top:"0",width:"100%",opacity:" 0.9","font-weight":"800","box-shadow":"0 2px 5px 0 rgba(0, 0, 0, 0.26)"}),this.$el.find("span").css({padding:"5px",display:"inline-block"}),this.$btnClose.css({position:"absolute",top:"0",right:"0",cursor:"pointer",padding:"5px","z-index":"99"})},CP.PopupFacebookPhotosItemType.prototype.renderImageToCanvasHandle=function(e){var i=t(e.target),n=i.data("img"),o=this;MYLIB.LOADING(),MYLIB.convertImgToBase64(n,function(t){MYLIB.REMOVE_LOADING(),MYLIB.eventManager.fireEvent(o,MYLIB.eventNames.event_upload_from_computer,t),MYLIB.eventManager.fireEvent(o,"CLOSE_POPUP_FACEBOOK",!0)})},MYLIB.mixin(CP.PopupFacebookPhotosItemType,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.PopupFacebookPhotosItem=function(){this.$el=null,this.html='<div class="list-photos-album-item-wrapper"></div>',this.data=null,this.typePhoto=null},CP.PopupFacebookPhotosItem.prototype.init=function(e){this.data=e,this.$el=t(this.html),this.typePhoto=new CP.PopupFacebookPhotosItemType;var i=this,n=_.min(e.images,function(t){return t.width}),o='<img src="{0}" class="thumbnail"/>';o=o.format(n.source),i.$el.append(o),this.typePhoto.init(e.images),this.$el.append(this.typePhoto.getElement()),this.typePhoto.hide(),this.bindEvent()},CP.PopupFacebookPhotosItem.prototype.show=function(){this.$el.removeClass("no-show")},CP.PopupFacebookPhotosItem.prototype.hide=function(){this.$el.addClass("no-show")},CP.PopupFacebookPhotosItem.prototype.getElement=function(){return this.$el},CP.PopupFacebookPhotosItem.prototype.bindEvent=function(){this.$el.unbind("click touchstart").bind("click touchstart",this.openTypePhotosHandle.bind(this))},CP.PopupFacebookPhotosItem.prototype.openTypePhotosHandle=function(t){this.typePhoto.show()}}(jQuery,window,document),function(t,e,i,n){CP.PopupFacebookPhotos=function(){this.$el=null,this.html='<div class="list-photos-album"><div class="next-photos">Load tiếp hình <i class="fa fa-angle-double-right fa-2x"></i></div></div>',this.dataPhoto=null,this.albumId=null,this.$btnNext=null},CP.PopupFacebookPhotos.prototype.init=function(e,i){this.dataPhoto=e,this.albumId=i,this.$el=t(this.html),this.$btnNext=this.$el.find(".next-photos"),this.renderLayout(e.data)},CP.PopupFacebookPhotos.prototype.renderLayout=function(t){var e=this;_.each(t,function(t,i,n){var o=new CP.PopupFacebookPhotosItem;o.init(t),e.$el.append(o.getElement())})},CP.PopupFacebookPhotos.prototype.show=function(){this.$el.removeClass("no-show")},CP.PopupFacebookPhotos.prototype.hide=function(){this.$el.addClass("no-show")},CP.PopupFacebookPhotos.prototype.getElement=function(){return this.$el},CP.PopupFacebookPhotos.prototype.bindEvent=function(){this.$btnNext.unbind("click touchstart").bind("click touchstart",this.loadMorePhototsHandle.bind(this))},CP.PopupFacebookPhotos.prototype.loadMorePhototsHandle=function(){var t=new CP.FacebookService,e=this;MYLIB.LOADING(),t.getImagesFromAlbums(this.albumId,20,this.dataPhoto.paging.cursors.after,function(t){MYLIB.REMOVE_LOADING(),0!==t.length&&(e.dataPhoto=t,e.renderLayout(t.data))},"")}}(jQuery,window,document),function(t,e,i,n){CP.PopupFacebookPhotosModule=function(){this.$el=null,this.html='<div class="photos-albums"></div>',this.dictPhoto={},this.facebookService=new CP.FacebookService},CP.PopupFacebookPhotosModule.prototype.init=function(){this.$el=t(this.html)},CP.PopupFacebookPhotosModule.prototype.getElement=function(){return this.$el},CP.PopupFacebookPhotosModule.prototype.show=function(t){this.hideAll(),this.dictPhoto[t]?this.dictPhoto[t].show():this.renderPhotosPage(t)},CP.PopupFacebookPhotosModule.prototype.renderPhotosPage=function(t){this.dictPhoto[t]=new CP.PopupFacebookPhotos;var e=this;MYLIB.LOADING(),this.facebookService.getImagesFromAlbums(t,20,"",function(i){e.dictPhoto[t].init(i,t),e.$el.append(e.dictPhoto[t].getElement()),e.dictPhoto[t].show(),e.dictPhoto[t].bindEvent(),MYLIB.REMOVE_LOADING()},"")},CP.PopupFacebookPhotosModule.prototype.hideAll=function(){_.each(this.dictPhoto,function(t){t.hide()})}}(jQuery,window,document),!function(t,e,i,n){CP.TextModuleCustom=function(){},CP.TextModuleCustom.prototype.html='<div id="text-module-custom" class="panel panel-default"><div class="panel-heading"><span>Chọn font chữ</span></div><div class="slide-font-size panel-body"><input id="{0}" type="range" min="0" max="50" value="{1}" step="1"  /><output id="{2}"></output></div></div>',CP.TextModuleCustom.prototype.$el=null,CP.TextModuleCustom.prototype.$rangeFontSzie=null,CP.TextModuleCustom.prototype.$outputRangeFontSzie=null,CP.TextModuleCustom.prototype.init=function(){this.html=this.html.format(MYLIB.constant.text_module_custom_font_size_id,CP_INIT.text.fontSize,MYLIB.constant.text_module_custom_font_size_output_id),this.$el=t(this.html),this.$rangeFontSzie=this.$el.find("#"+MYLIB.constant.text_module_custom_font_size_id),this.$outputRangeFontSzie=this.$el.find("#"+MYLIB.constant.text_module_custom_font_size_output_id);var e=this.$rangeFontSzie.val();this.$outputRangeFontSzie.html(e+"px"),this.style(),this.bindEvent()},CP.TextModuleCustom.prototype.style=function(){this.$el.css({border:"1px solid rgb(217, 237, 204)",margin:"10px 0px 0px 0px"}),this.$outputRangeFontSzie.css({margin:"0 auto","text-align":"center"})},CP.TextModuleCustom.prototype.getElement=function(){return this.$el},CP.TextModuleCustom.prototype.bindEvent=function(){this.$rangeFontSzie.unbind("change").bind("change",this,this.changeRangeFontSizeHandle)},CP.TextModuleCustom.prototype.changeRangeFontSizeHandle=function(t){var e=t.data,i=e.$rangeFontSzie.val();e.$outputRangeFontSzie.html(i+"px"),MYLIB.eventManager.fireEvent(e,MYLIB.eventNames.event_fontSize,i)},MYLIB.mixin(CP.TextModuleCustom,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.TextFormModule=function(){},CP.TextFormModule.prototype.html='<div class="panel-body" id="text-form-module"><input type="text" id="form-text" class="input" placeholder="Your sologan :D" /><button id="submit-form-text" class="btn btn-default" style="position:absolute"><span class="glyphicon glyphicon-plus"></span></button></div>',CP.TextFormModule.prototype.$el=null,CP.TextFormModule.prototype.$btnSubmit=null,CP.TextFormModule.prototype.$inputText=null,CP.TextFormModule.prototype.init=function(){this.$el=t(this.html),this.$btnSubmit=this.$el.find("#submit-form-text"),this.$inputText=this.$el.find("#form-text"),this.bindEvent()},CP.TextFormModule.prototype.getElement=function(){return this.$el},CP.TextFormModule.prototype.bindEvent=function(){var t=this;this.$btnSubmit.unbind("click touchstart").bind("click touchstart",this.submitHandle.bind(this)),this.$inputText.keypress(function(e){13==e.which&&t.submitHandle()})},CP.TextFormModule.prototype.submitHandle=function(){var t=this.$inputText.val();""!=t?MYLIB.eventManager.fireEvent(this,MYLIB.eventNames.event_submit_text,t):alert("PLEASE ENTER YOUR CUSTOM TEXT")},MYLIB.mixin(CP.TextFormModule,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.TextModule=function(){},CP.TextModule.prototype.html='<div data-step="5" data-intro="Đánh chữ vào ô và bấm nút + để thêm chữ vào sản phẩm" class="panel" id="text-module"><div class="panel-heading"><i class="ion-ios-compose size-18"></i> Nhập text vào sản phẩm</div></div>',CP.TextModule.prototype.$el=null,CP.TextModule.prototype.formText=null,CP.TextModule.prototype.init=function(){this.$el=t(this.html),this.renderLayout()},CP.TextModule.prototype.renderLayout=function(){this.formText=new CP.TextFormModule,this.formText.init(),this.$el.append(this.formText.getElement())},CP.TextModule.prototype.getElement=function(){return this.$el},MYLIB.mixin(CP.TextModule,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n,o){CP.EditFontModule=function(e){if(this.viewPath="js/module/text.module/popup.edit.font/view/template.html",this.callbackDashboard=e,t==o)throw"Require D3js";this.fill=null,this.layout=null,this.words=null;var i=this;this.drawClouldText=function(e,n){i.$el.find(".d3-cloud-text-demo").html(""),i.words=e,t.select(i.$el.find(".d3-cloud-text-demo")[0]).append("svg").attr("width",i.layout.size()[0]).attr("height",i.layout.size()[1]).append("g").attr("transform","translate("+i.layout.size()[0]/2+","+i.layout.size()[1]/2+")").selectAll("text").data(e).enter().append("text").style("font-size",function(t){return t.size+"px"}).style("font-family",n).style("fill",function(t,e){return t.fillColor}).attr("text-anchor","middle").attr("transform",function(t){return"translate("+[t.x,t.y]+")rotate("+t.rotate+")"}).text(function(t){return t.text})},this.setLayoutD3Clould=function(e,n){e==o&&(e=["Nhập","ký tự","mà","bạn","mong","muốn","words","vào","ô","ở","dưới"]),n==o&&(n="arial"),this.layout=t.layout.cloud().size([500,300]).words(e.map(function(t){return{text:t,size:10+90*Math.random(),fillColor:i.fill(t)}})).padding(5).rotate(function(){return 90*~~(2*Math.random())}).font(n).fontSize(function(t){return t.size}).on("end",function(t){i.drawClouldText(t,n)}),this.layout.start()}},MYLIB.extend(CP.EditFontModule,CP.PopupModule),CP.EditFontModule.prototype.$elSelect=null,CP.EditFontModule.prototype.$spanThuNghiem=null,CP.EditFontModule.prototype.customTextControl=null,CP.EditFontModule.prototype.$inputUploadPartern=null,CP.EditFontModule.prototype.$elSelectV2=null,CP.EditFontModule.prototype.$elInputFontWeight=null,CP.EditFontModule.prototype.init=function(){this.titlePopup="Chỉnh sửa font chử",this.parent.proto.init.call(this),this.$el.find(".modal-dialog").removeClass("modal-lg"),this.$el.appendTo("body"),this.render()},CP.EditFontModule.prototype.getElement=function(){return this.$el},CP.EditFontModule.prototype.render=function(){var i=this;e.get(this.viewPath,function(n){var o=e(n).html(),a=Handlebars.compile(o),s=a();i.$elContent.append(e(s)),i.initElement.call(i),i.bindEvent(),i.fill=t.scale.category20(),i.setLayoutD3Clould()})},CP.EditFontModule.prototype.initElement=function(){this.$elSelect=this.$elContent.find(".font-select"),this.$spanThuNghiem=this.$elContent.find(".thunghiem"),this.$elSelectV2=this.$elContent.find(".font-select-v2"),this.$inputUploadPartern=this.$el.find('input[name="imagePatternFormComputer"]'),this.$elInputFontWeight=this.$el.find('input[name="fontW"]'),this.$elSelect.css({width:"100%",height:"50px","font-size":"30px"}),this.renderFontSelect(CP_INIT.text.listFont)},CP.EditFontModule.prototype.renderFontSelect=function(t){var i=this;_.each(t,function(t,n,o){var a='<option value="{0}">{1}</option>';a=a.format(t.font,t.label),a=e(a),i.$elSelect.append(a);var s='<label style="padding:5px"><input type="radio" name="fontvalue" value="{0}"> <span style="font-family: {1};font-size:20px">SAMPLE</span> </label>';s=s.format(t.label,t.font),s=e(s),e(s).find("input").unbind("click").bind("click",i.changeFontHandlerV2.bind(i)),i.$elSelectV2.append(s)})},CP.EditFontModule.prototype.bindEvent=function(){var t=this.$elSelect.val(),e=this;this.$spanThuNghiem.css({"font-family":t}),this.$elSelect.change(this.changeFontHandler.bind(this)),this.$inputUploadPartern.unbind("change").bind("change",this,this.imageFileFromComputerHandle),this.$el.find('input[name="check-curve-text"]').unbind("change").bind("change",this,this.changeCurveTextHandle),this.$elInputFontWeight.unbind("change").bind("change",this.changeFontWeightHandle.bind(this)),this.$el.find('textarea[name="clould-world"]').bind("change",function(t){}),this.$el.find("button.btn-cloud-text-submit").click(function(t){var i=n.createElement("canvas"),o=i.getContext("2d");i.width=500,i.height=300,o.translate(250,150),e.words.forEach(function(t){o.save(),o.translate(t.x,t.y),o.rotate(t.rotate*Math.PI/180),o.textAlign="center",o.fillStyle=e.fill(t.text.toLowerCase()),o.font=t.size+"px "+t.font,o.fillText(t.text,0,0),o.restore()}),MYLIB.eventManager.fireEvent(e,MYLIB.eventNames.event_upload_from_computer,i.toDataURL("image/png")),e.hide()}),this.$el.find("button.xem-truoc").click(function(t){var i=e.$el.find("input[name=fontvalue]:checked").val();e.setLayoutD3Clould(e.$el.find('textarea[name="clould-world"]').val().split(" "),i)})},CP.EditFontModule.prototype.imageFileFromComputerHandle=function(t){var e=t.data,i=new FileReader;i.onload=function(t){MYLIB.eventManager.fireEvent(e,MYLIB.eventNames.event_change_partern,t.target.result)},i.readAsDataURL(t.target.files[0])},CP.EditFontModule.prototype.changeFontHandler=function(){var t=this.$elSelect.val();console.log(t),this.$spanThuNghiem.css({"font-family":t}),MYLIB.eventManager.fireEvent(this,MYLIB.eventNames.event_change_font,t)},CP.EditFontModule.prototype.changeFontHandlerV2=function(t){var i=e(t.target).val();this.$spanThuNghiem.css({"font-family":i}),MYLIB.eventManager.fireEvent(this,MYLIB.eventNames.event_change_font,i)},CP.EditFontModule.prototype.changeCurveTextHandle=function(){MYLIB.eventManager.fireEvent(this,"CURVER_TEXT",!0)},CP.EditFontModule.prototype.changeFontWeightHandle=function(t){var i=e(t.target).val();this.$spanThuNghiem.css({"font-weight":i}),MYLIB.eventManager.fireEvent(this,"CHANGEFONTWEIGHT",i)},MYLIB.mixin(CP.PopupAssetsModule,MYLIB.Event.ObserverMixin)}(d3,jQuery,window,document),!function(t,e,i,n){CP.ToolController=function(){this.view=null,this.model=null,this.callbackScopeRightModule=null},CP.ToolController.prototype.init=function(t,e){this.callbackScopeRightModule=t,this.view=new CP.ToolView,this.model=new CP.ToolModelService,this.model.init(),this.view.init(this.model),this.view.render(this.renderView.bind(this,e))},CP.ToolController.prototype.renderView=function(t){t.call(this),this.bindEvent()},CP.ToolController.prototype.bindEvent=function(){this.view.bindEvent(this)},CP.ToolController.prototype.showObjectUpHandle=function(){var t=this.callbackScopeRightModule.mainCanvas;t.showUpHandle.call(t)},CP.ToolController.prototype.backObjectUpHandle=function(){var t=this.callbackScopeRightModule.mainCanvas;t.BackToUpHandle.call(t)},CP.ToolController.prototype.rotateRepeatHandle=function(){var t=this.callbackScopeRightModule.mainCanvas;t.rotateRepeatHandle.call(t)},CP.ToolController.prototype.checkOutHandle=function(){this.callbackScopeRightModule.mainCanvas.resetOverlayImageCanvas(),MYLIB.eventManager.fireEvent(this,MYLIB.eventNames.event_checkout,!0)},CP.ToolController.prototype.openPopupEditImgs=function(){MYLIB.eventManager.fireEvent(this,MYLIB.eventNames.event_open_edit_imgs,!0)},CP.ToolController.prototype.openPopupFonts=function(){MYLIB.eventManager.fireEvent(this,MYLIB.eventNames.event_open_font_edit,!0)},CP.ToolController.prototype.openPopupEditPictures=function(){MYLIB.eventManager.fireEvent(this,"OPEN_EDIT_PICTURES",!0)},MYLIB.mixin(CP.ToolController,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.ToolsModule=function(){this.controller=null,this.callbackScopeRightModule=null},CP.ToolsModule.prototype.init=function(t,e){this.controller=new CP.ToolController,this.callBackFunction=t,this.controller.init(t,e)},MYLIB.mixin(CP.ToolsModule,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.ToolModelService=function(){this.path="js/module/tool.module/view/tool.view.html",this.data={title:"Tools"}},CP.ToolModelService.prototype.init=function(){return!0},CP.ToolModelService.prototype.getElement=function(){},CP.ToolModelService.prototype.bindEvent=function(){},MYLIB.mixin(CP.ToolModelService,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.ToolView=function(){this.$el=null,this.$btnShowup=null,this.$btnBackup=null,this.$btnRotateRepeat=null,this.$btnCheckOut=null,this.$btnOpenEffectImgs=null,this.$btnOpenFont=null,this.$btnOpenEditImgs=null,this.modelService=null,this.init=function(t){this.modelService=t}},CP.ToolView.prototype.render=function(e){var i=this;t.get(this.modelService.path,function(n){var o=t(n).html(),a=Handlebars.compile(o),s=a(i.modelService.data);i.$el=t(s),i.initElement.call(i),e.call(this)})},CP.ToolView.prototype.initElement=function(){this.$btnShowup=this.$el.find(".show-up"),this.$btnBackup=this.$el.find(".back-up"),this.$btnRotateRepeat=this.$el.find(".rotate-repeat"),this.$btnCheckOut=this.$el.find(".checkout-btn"),this.$btnOpenEffectImgs=this.$el.find(".open-effect-img"),this.$btnOpenFont=this.$el.find(".open-fonts"),this.$btnOpenEditImgs=this.$el.find(".open-edit-img"),t('[data-toggle="tooltip"]').tooltip()},CP.ToolView.prototype.getElement=function(){return this.$el},CP.ToolView.prototype.bindEvent=function(t){this.$btnShowup.unbind("click touchstart").bind("click touchstart",t.showObjectUpHandle.bind(t)),this.$btnBackup.unbind("click touchstart").bind("click touchstart",t.backObjectUpHandle.bind(t)),this.$btnRotateRepeat.unbind("click touchstart").bind("click touchstart",t.rotateRepeatHandle.bind(t));var e=this;MYLIB.click(e.$btnCheckOut,t.checkOutHandle.bind(t)),this.$btnOpenEffectImgs.unbind("click touchstart").bind("click touchstart",t.openPopupEditImgs.bind(t)),this.$btnOpenFont.unbind("click touchstart").bind("click touchstart",t.openPopupFonts.bind(t)),MYLIB.click(e.$btnOpenEditImgs,t.openPopupEditPictures.bind(t))},MYLIB.mixin(CP.ToolView,MYLIB.Event.ObserverMixin)}(jQuery,window,document),!function(t,e,i,n){"use strick";CP.DisplayImgController=function(){this.view=null,this.model=null},CP.DisplayImgController.prototype.init=function(){this.view=new CP.DisplayImgModuleView,this.view.init(),this.model=new CP.DisplayImgModuleModel,this.model.init(),this.view.render([this.model.CLASS,this.model.ID]),this.bindEvent()},CP.DisplayImgController.prototype.bindEvent=function(){MYLIB.eventManager.subscribe(this,MYLIB.eventNames.event_display_img,"addDisplayImageUploadHandle"),this.view.bindEvent(this)},CP.DisplayImgController.prototype.renderImageHandle=function(e){var i=t(e.target);if(i.attr("src")!==n){var o=i.attr("src");MYLIB.eventManager.fireEvent(this,MYLIB.eventNames.event_upload_from_computer,o)}},CP.DisplayImgController.prototype.addDisplayImageUploadHandle=function(t){var e=t.data;this.view.renderItem(e)},MYLIB.mixin(CP.DisplayImgController,MYLIB.Event.ObserverMixin)}(jQuery,window,document),CP.DisplayImgModule=function(){this.controller=null},CP.DisplayImgModule.prototype.init=function(){this.controller=new CP.DisplayImgController,this.controller.init()},MYLIB.mixin(CP.DisplayImgModule,MYLIB.Event.ObserverMixin),function(t,e,i,n){CP.DisplayImgModuleModel=function(){this.ID="display-img-module",this.CLASS="display-img-module",this.data={}},CP.DisplayImgModuleModel.prototype.init=function(){return!0},MYLIB.mixin(CP.DisplayImgModuleModel,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.DisplayImgModuleView=function(){this.html="",this.$el=null,this.$loading=null,this.controller=null,this.init=function(){this.html='<div style="position:relative" class="table-responsive {0}" id="{1}"><table class="table table-bordered"><tbody><tr></tr></tbody></table></div>'}},CP.DisplayImgModuleView.prototype.style=function(){this.$el.css({})},CP.DisplayImgModuleView.prototype.loading=function(){var e='<img src="imgs/theme/loader.gif" />';this.$loading=t(e),this.$loading.css({position:"absolute",top:"0"}),this.$el.append(this.$loading)},CP.DisplayImgModuleView.prototype.detachLoading=function(){this.$loading.remove()},CP.DisplayImgModuleView.prototype.render=function(e){if(!t.isArray(e))throw"Data render must be array";this.html=this.html.format(e[0],e[1]),this.$el=t(this.html),this.style()},CP.DisplayImgModuleView.prototype.renderItem=function(e){this.loading();var i=t("<td></td>"),n='<img src="{0}"/>';n=n.format(e),n=t(n),n.css({"max-width":"50px",cursor:"pointer"}),i.append(n),this.$el.find("tr").append(i),i.unbind("click touchstart").bind("click touchstart",this.controller.renderImageHandle);var o=this;setTimeout(function(){o.detachLoading()},1e3)},CP.DisplayImgModuleView.prototype.getElement=function(){return this.$el},CP.DisplayImgModuleView.prototype.bindEvent=function(t){this.controller=t},MYLIB.mixin(CP.DisplayImgModuleView,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){"use strick";CP.EffectImgBtn=function(){this.html='<div class="upload-assets-img" style="margin: 5px 0px 5px 0px;"><div class="assets-img-button"><button type="button" class="btn btn-default choose-image-from-assets" style="width:100%;position:relative;padding:10px"><i class="fa fa-picture-o fa-2x" aria-hidden="true" style="position:absolute;left:5px;top:7px;color:#c9c9c9"></i> Chỉnh màu</button><br/></div></div>',this.$el=null,this.$btnUpload=null},CP.EffectImgBtn.prototype.init=function(){this.$el=t(this.html),this.$btnUpload=this.$el.find(".choose-image-from-assets"),this.bindEvent()},CP.EffectImgBtn.prototype.getElement=function(){return this.$el},CP.EffectImgBtn.prototype.bindEvent=function(){this.$btnUpload.unbind("click touchstart").bind("click touchstart",this.openEffectImgsHandle.bind(this))},CP.EffectImgBtn.prototype.openEffectImgsHandle=function(t){MYLIB.eventManager.fireEvent(this,MYLIB.eventNames.event_open_edit_imgs,!0)},MYLIB.mixin(CP.EffectImgBtn,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){"use strick";CP.TakeSnapshotBtn=function(){this.html='<div class="upload-assets-img" style="margin: 5px 0px 5px 0px;"><div class="assets-img-button"><button type="button" class="btn btn-default take-snapshot-btn" style="width:100%;position:relative;padding:10px"><i class="ion-ios-camera-outline size-48" aria-hidden="true" style="position:absolute;left:5px;top:-13px;color:#c9c9c9"></i> Say cheese</button><br/></div></div>',this.$el=null,this.$btnSnapshot=null},CP.TakeSnapshotBtn.prototype.init=function(){this.$el=t(this.html),this.$btnSnapshot=this.$el.find(".take-snapshot-btn"),this.bindEvent()},CP.TakeSnapshotBtn.prototype.getElement=function(){return this.$el},CP.TakeSnapshotBtn.prototype.bindEvent=function(){this.$btnSnapshot.unbind("click touchstart").bind("click touchstart",this.openSnapshotHandle.bind(this))},CP.TakeSnapshotBtn.prototype.openSnapshotHandle=function(t){MYLIB.eventManager.fireEvent(this,MYLIB.eventNames.event_open_snapshot,!0)}}(jQuery,window,document),function(t,e,i,n){"use strick";CP.UploadFromAssetModule=function(){this.html='<div data-step="7" data-intro="Chọn hình từ thư viện của chúng tôi" class="upload-assets-img" style="margin: 5px 0px 5px 0px;"><div class="assets-img-button"><button type="button" class="btn btn-default choose-image-from-assets" style="width:100%;position:relative;padding:10px"><i class="fa fa-tree fa-2x" aria-hidden="true" style="position:absolute;left:5px;top:7px;color:#ff00dd"></i> Hình & Pattern</button><br/></div></div>',this.$el=null,this.$btnUpload=null,this.assetsApplication=null},CP.UploadFromAssetModule.prototype.init=function(){this.$el=t(this.html),this.$btnUpload=this.$el.find(".choose-image-from-assets"),this.assetsApplication=new CP.PopupAssetsModule,this.bindEvent()},CP.UploadFromAssetModule.prototype.getElement=function(){return this.$el},CP.UploadFromAssetModule.prototype.bindEvent=function(){this.$btnUpload.unbind("click touchstart").bind("click touchstart",this.openPopupAssetsImagesHandler.bind(this))},CP.UploadFromAssetModule.prototype.openPopupAssetsImagesHandler=function(t){this.assetsApplication.firstRender?this.assetsApplication.show():(this.assetsApplication.init(),this.assetsApplication.show())},MYLIB.mixin(CP.UploadFromAssetModule,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.UploadFromComputerController=function(){},CP.UploadFromComputerController.prototype.$el=null,CP.UploadFromComputerController.prototype.html='<div data-step="3" data-intro="Chọn hình từ máy tính" class="panel panel-default" id="{0}"><div class="panel-heading"><i class="ion-ios-upload size-18"></i> Upload ảnh từ máy tính</div></div>',CP.UploadFromComputerController.prototype.ID="upload-from-controller-wrapper",CP.UploadFromComputerController.prototype.formController=null,CP.UploadFromComputerController.prototype.init=function(){this.html=this.html.format(this.ID),this.$el=t(this.html),this.formController=new CP.UploadFromComputer_Form,this.formController.init(),this.renderLayout()},CP.UploadFromComputerController.prototype.getElement=function(){return this.$el},CP.UploadFromComputerController.prototype.renderLayout=function(){this.$el.append(this.formController.getElement())},MYLIB.mixin(CP.UploadFromComputerController,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){CP.UploadFromComputer_Form=function(){},CP.UploadFromComputer_Form.prototype.$el=null,CP.UploadFromComputer_Form.prototype.html='<div class="panel-body" id="{0}"><input type="file" accept="image/*" name="imageLoader" style="width:163px"/><br/></div>',CP.UploadFromComputer_Form.prototype.ID="upload-from-controller-form",CP.UploadFromComputer_Form.prototype.inputChooseFile=null,CP.UploadFromComputer_Form.prototype.init=function(){this.html=this.html.format(this.ID),this.$el=t(this.html),this.inputChooseFile=this.$el.find("input"),this.bindEvent()},CP.UploadFromComputer_Form.prototype.getElement=function(){return this.$el},CP.UploadFromComputer_Form.prototype.bindEvent=function(){this.inputChooseFile.unbind("change").bind("change",this,this.imageFileFromComputerHandle)},CP.UploadFromComputer_Form.prototype.imageFileFromComputerHandle=function(t){var e=t.data,i=new FileReader;i.onload=function(t){MYLIB.eventManager.fireEvent(e,MYLIB.eventNames.event_upload_from_computer,t.target.result)},i.readAsDataURL(t.target.files[0])},MYLIB.mixin(CP.UploadFromComputer_Form,MYLIB.Event.ObserverMixin)}(jQuery,window,document),function(t,e,i,n){"use strick";CP.UploadFromFacebookModule=function(){this.html='<div data-step="1" data-intro="Chọn hình từ facebook của các bạn" class="upload-facebook-img" style="margin: 5px 0px 5px 0px;"><div class="facebook-img-button"><button type="button" class="btn btn-default choose-image-from-facebook" style="width:100%;position:relative;padding:10px"><i class="fa fa-facebook-square fa-2x" aria-hidden="true" style="position:absolute;left:5px;top:7px;color:#3a5795"></i> Hình Facebook</button><br/></div></div>',this.$el=null,this.$btnFacebook=null,this.facebookApplication=null},CP.UploadFromFacebookModule.prototype.init=function(){this.$el=t(this.html),this.$btnFacebook=this.$el.find(".choose-image-from-facebook"),this.facebookApplication=new CP.PopupFacebookModule,this.bindEvent()},CP.UploadFromFacebookModule.prototype.getElement=function(){
return this.$el},CP.UploadFromFacebookModule.prototype.bindEvent=function(){this.$btnFacebook.unbind("click touchstart").bind("click touchstart",this,this.openPopupFacebookImagesHandler)},CP.UploadFromFacebookModule.prototype.openPopupFacebookImagesHandler=function(t){var e=t.data,i=CP.SingletonUser.getInstance();i.getFacebook(),MYLIB.LOADING(),i.checkFacebookObj(function(t){MYLIB.REMOVE_LOADING(function(){e.initFacebookApplication()})},function(){i.loginFacebook(function(){MYLIB.REMOVE_LOADING(function(){e.initFacebookApplication()})})},function(){i.loginFacebook(function(){MYLIB.REMOVE_LOADING(function(){e.initFacebookApplication()})})})},CP.UploadFromFacebookModule.prototype.initFacebookApplication=function(){this.facebookApplication.firstRender?this.facebookApplication.show():(this.facebookApplication.init(),this.facebookApplication.show())},MYLIB.mixin(CP.UploadFromFacebookModule,MYLIB.Event.ObserverMixin)}(jQuery,window,document),!function(t,e,i,n){CP.User=function(){this.name="",this.avatar="",this.email="",this.facebookObj={status:null,album:null,key:"facebook_obj"},this.id=null,this.key="cyo_user"},CP.User.prototype.init=function(){},CP.User.prototype.loginFacebook=function(t){var e=this,i=new CP.FacebookService;i.loginFacebook(function(){e.checkFacebookObj(),t()})},CP.User.prototype.getFacebook=function(){return localStorage[this.facebookObj.key]!=n?jQuery.parseJSON(localStorage[this.facebookObj.key]):null},CP.User.prototype.checkFacebookObj=function(t,e,i){var n=new CP.FacebookService,o=this;n.checkLogin(function(e){console.log(e),o.setFacebook(e),"function"==typeof t&&t(e)},function(i){"function"==typeof t&&e(i)},function(e){"function"==typeof t&&i(e)})},CP.User.prototype.setFacebook=function(t){localStorage[this.facebookObj.key]=JSON.stringify(t),this.facebookObj.status=localStorage[this.facebookObj.key]},CP.User.prototype.checkLogin=function(){},CP.User.prototype.getName=function(){return this.name},CP.User.prototype.setName=function(t){this.name=t},CP.SingletonUser=function(){function t(t,e){var i=new CP.User;return i.init(),i}var e;return{getInstance:function(){return e||(e=t()),e}}}()}(jQuery,window,document),!function(t,e,i,n){CP.Validate=function(){var t=/^[0-9]+$/,e=/^\-?[0-9]+$/,i=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,n=/^[a-z]+$/i,o=/^[a-zA-ZÀÁÂÃÈÉÊÌÍÒÓÔÕÙÚĂĐĨŨƠàáâãèéêìíòóôõùúăđĩũơƯĂẠẢẤẦẨẪẬẮẰẲẴẶẸẺẼỀỀỂưăạảấầẩẫậắằẳẵặẹẻẽềềểỄỆỈỊỌỎỐỒỔỖỘỚỜỞỠỢỤỦỨỪễệỉịọỏốồổỗộớờởỡợụủứừỬỮỰỲỴÝỶỸửữựỳỵỷỹ ]+$/i,a=function(t){var e=i.exec(t);return e},s=function(e,i,n){if(e.length>i&&e.length<=n){var o=t.exec(e);return o}return!1},r=function(t,e){if(t.length>e){var i=n.exec(t);return i}return!1},l=function(t,e){if(t.length>e){var i=o.exec(t);return i}return!1},c=function(t,i,n){if(t>i&&n>t){var o=e.exec(t);return o}return!1};return{checkEmail:a,checkPhone:s,checkUsername:r,checkFullName:l,checkNumber:c}}()}(jQuery,window,document);